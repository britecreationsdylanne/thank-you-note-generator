<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thank You Note Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Dancing+Script:wght@400;700&family=Caveat:wght@400;700&family=Great+Vibes&family=Satisfy&family=Kalam:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #E1E7EF;
            color: #272D3F;
            line-height: 1.6;
        }

        h1, h2, h3 {
            font-family: 'Poppins', sans-serif;
            color: #272D3F;
            font-weight: 600;
        }
        
        .brand-badge {
            background: white;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-size: 0.875rem;
            color: #666;
            display: inline-block;
            margin-bottom: 2rem;
        }
        
        .hero-section {
            text-align: center;
            padding: 3rem 2rem;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .hero-section h1 {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            color: #008182;
            margin-bottom: 1rem;
            font-weight: 500;
        }
        
        .hero-description {
            font-size: 1.125rem;
            color: #666;
            margin-bottom: 3rem;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto 3rem;
            padding: 0 2rem;
        }
        
        .feature-card {
            background: linear-gradient(135deg, #E1E7EF 0%, #F4F7FC 100%);
            border-radius: 16px;
            padding: 2.5rem 2rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid rgba(0, 129, 130, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: #272D3F;
        }
        
        .feature-card p {
            color: #666;
            font-size: 1rem;
        }
        
        .how-it-works {
            background: linear-gradient(135deg, #008182 0%, #31D7CA 100%);
            border-radius: 24px;
            padding: 3rem 2rem;
            max-width: 1200px;
            margin: 0 auto 3rem;
            box-shadow: 0 4px 16px rgba(0,129,130,0.2);
        }
        
        .how-it-works h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: white;
        }
        
        .steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            text-align: center;
        }
        
        .step-number {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            color: #008182;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0 auto 1rem;
        }

        .step h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: white;
        }

        .step p {
            color: rgba(255, 255, 255, 0.95);
            font-size: 0.95rem;
        }

        .tip {
            text-align: center;
            margin-top: 2rem;
            color: white;
            font-size: 0.95rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem;
            border-radius: 12px;
        }
        
        .btn-primary {
            background: #FF6B35;
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.125rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);
        }

        .btn-primary:hover {
            background: #E85A2A;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 53, 0.4);
            box-shadow: 0 4px 12px rgba(0,129,130,0.3);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: white;
            color: #008182;
            border: 2px solid #31D7CA;
            padding: 0.75rem 2rem;
            font-size: 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #F4F7FC;
            border-color: #008182;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            color: #008182;
            text-decoration: none;
            margin-bottom: 2rem;
            font-weight: 500;
            cursor: pointer;
        }

        .back-link:hover {
            color: #31D7CA;
        }
        
        .page-title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .page-subtitle {
            color: #666;
            font-size: 1.125rem;
            margin-bottom: 2rem;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }
        
        .upload-zone {
            border: 3px dashed #31D7CA;
            border-radius: 12px;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-zone:hover, .upload-zone.drag-over {
            background: #F4F7FC;
            border-color: #B8855B;
        }
        
        .upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #999;
        }
        
        .upload-text {
            font-size: 1.25rem;
            color: #008182;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .upload-hint {
            color: #999;
            font-size: 1rem;
        }
        
        .button-row {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        label {
            display: block;
            font-weight: 600;
            color: #008182;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #31D7CA;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #008182;
            box-shadow: 0 0 0 3px rgba(45,88,83,0.1);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .form-section {
            margin-bottom: 1.5rem;
        }
        
        .option-grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }
        
        .option-box {
            border: 3px solid #ddd;
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .option-box:hover {
            border-color: #31D7CA;
        }
        
        .option-box.selected {
            border-color: #008182;
            background: #E1E7EF;
        }
        
        .option-box h4 {
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: #008182;
        }
        
        .color-swatch {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .font-preview {
            font-size: 1.5rem;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .font-georgia { font-family: Georgia, serif; }
        .font-times { font-family: 'Times New Roman', serif; }
        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-caveat { font-family: 'Caveat', cursive; }
        .font-kalam { font-family: 'Kalam', cursive; }
        .font-vibes { font-family: 'Great Vibes', cursive; }
        .font-satisfy { font-family: 'Satisfy', cursive; }
        .font-palatino { font-family: 'Palatino Linotype', serif; }
        .font-garamond { font-family: Garamond, serif; }
        
        .pattern-preview {
            height: 60px;
            border-radius: 8px;
        }
        
        .pattern-solid { background: white; border: 1px solid #ddd; }
        .pattern-stripes { background: repeating-linear-gradient(45deg, #fff, #fff 8px, #f5f5f5 8px, #f5f5f5 16px); border: 1px solid #ddd; }
        .pattern-dots { background-image: radial-gradient(circle, #ddd 2px, transparent 2px); background-size: 20px 20px; background-color: white; border: 1px solid #ddd; }
        .pattern-floral { background: white url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="60" height="60"><text x="15" y="30" font-size="20" fill="%23ddd">‚ùÄ</text><text x="35" y="50" font-size="15" fill="%23ddd">‚ùÄ</text></svg>'); }
        .pattern-hearts { background: white; background-image: radial-gradient(circle at 25% 25%, rgba(255,192,203,0.3) 5%, transparent 20%), radial-gradient(circle at 75% 75%, rgba(255,192,203,0.3) 5%, transparent 20%); background-size: 40px 40px; }
        .pattern-diamonds { background: white; background-image: linear-gradient(45deg, #f5f5f5 25%, transparent 25%), linear-gradient(-45deg, #f5f5f5 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f5f5f5 75%), linear-gradient(-45deg, transparent 75%, #f5f5f5 75%); background-size: 30px 30px; background-position: 0 0, 0 15px, 15px -15px, -15px 0px; }
        .pattern-waves { background: white; background-image: repeating-radial-gradient(circle at 0 0, transparent 0, white 10px), repeating-linear-gradient(#f5f5f5, #f5f5f5); }
        .pattern-grid { background: white; background-image: linear-gradient(#f5f5f5 1px, transparent 1px), linear-gradient(90deg, #f5f5f5 1px, transparent 1px); background-size: 20px 20px; }
        
        .seal-preview-box {
            width: 80px;
            height: 80px;
            margin: 0 auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: bold;
            color: #333;
            position: relative;
        }
        
        .seal-classic {
            border: 2px solid currentColor;
        }

        .seal-double {
            border: 2px solid currentColor;
            box-shadow: inset 0 0 0 6px currentColor;
        }

        .seal-ornate {
            border: 3px solid currentColor;
        }
        .seal-ornate::before {
            content: '‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢';
            position: absolute;
            font-size: 0.5rem;
            top: 4px;
            left: 0;
            right: 0;
            text-align: center;
            letter-spacing: 4px;
        }

        .seal-scalloped {
            border: 2px solid currentColor;
            box-shadow: inset 0 0 0 1px currentColor, inset 0 0 0 8px currentColor;
        }

        .seal-botanical {
            border: 2px solid currentColor;
            background-image:
                radial-gradient(circle at 50% 15%, currentColor 1px, transparent 1px),
                radial-gradient(circle at 50% 15%, transparent 2px, currentColor 3px, transparent 4px),
                radial-gradient(circle at 85% 50%, currentColor 1px, transparent 1px),
                radial-gradient(circle at 85% 50%, transparent 2px, currentColor 3px, transparent 4px),
                radial-gradient(circle at 50% 85%, currentColor 1px, transparent 1px),
                radial-gradient(circle at 50% 85%, transparent 2px, currentColor 3px, transparent 4px),
                radial-gradient(circle at 15% 50%, currentColor 1px, transparent 1px),
                radial-gradient(circle at 15% 50%, transparent 2px, currentColor 3px, transparent 4px);
            background-size: 100% 100%;
            background-repeat: no-repeat;
        }

        .seal-vintage {
            border: 2px dashed currentColor;
        }

        .seal-art-deco {
            border: 3px solid currentColor;
        }

        .seal-minimal {
            border: 1px solid currentColor;
        }
        
        .guest-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .guest-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .guest-item-info {
            flex: 1;
        }
        
        .guest-item-info strong {
            display: block;
            margin-bottom: 0.25rem;
        }
        
        .guest-item-info span {
            font-size: 0.875rem;
            color: #666;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #d32f2f;
            cursor: pointer;
            font-size: 1.5rem;
            padding: 0.5rem;
        }
        
        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .download-card {
            background: white;
            border-radius: 12px;
            padding: 2rem 1.5rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .download-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .download-card h4 {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        
        .download-card p {
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .print-shops {
            background: #E1E7EF;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .print-shops h4 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .shops-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .shop-item {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
        }
        
        .shop-item strong {
            display: block;
            margin-bottom: 0.5rem;
            color: #008182;
            font-size: 1.125rem;
        }
        
        .shop-item p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }
        
        .shop-item a {
            color: #008182;
            text-decoration: none;
            font-weight: 600;
            display: inline-block;
        }
        
        .shop-item a:hover {
            color: #31D7CA;
        }
        
        .shop-distance {
            font-size: 0.875rem;
            color: #31D7CA;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        input[type="file"] {
            display: none;
        }
        
        .address-suggestions {
            border: 2px solid #31D7CA;
            border-top: none;
            border-radius: 0 0 10px 10px;
            background: white;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .address-suggestion {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .address-suggestion:hover {
            background: #E1E7EF;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .page-title {
                font-size: 1.75rem;
            }

            .page-subtitle {
                font-size: 1rem;
            }

            .card {
                padding: 1.25rem;
            }

            /* Stack homepage feature cards on mobile */
            .features-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 0 1rem;
            }

            .feature-card {
                padding: 1.5rem 1.25rem;
            }

            .feature-icon {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }

            .feature-card h3 {
                font-size: 1.25rem;
            }

            /* Stack how it works steps on mobile */
            .steps-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .how-it-works {
                padding: 2rem 1.5rem;
            }

            .how-it-works h2 {
                font-size: 1.75rem;
                margin-bottom: 2rem;
            }

            /* Stack option grids on mobile */
            .option-grid-4 {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
            }

            /* Stack form grids on mobile */
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Stack download grid on mobile */
            .download-grid {
                grid-template-columns: 1fr;
            }

            /* Adjust button sizes */
            .btn-primary, .btn-secondary {
                padding: 0.875rem 1.5rem;
                font-size: 0.95rem;
            }

            /* Smaller font previews on mobile */
            .font-preview {
                font-size: 1.25rem;
                height: 40px;
            }

            /* Adjust color swatches */
            .color-swatch {
                height: 50px;
            }

            /* Mobile upload zone */
            .upload-zone {
                padding: 2.5rem 1.5rem;
            }

            .upload-icon {
                font-size: 2.5rem;
            }

            .upload-text {
                font-size: 1.1rem;
            }
        }

        /* Extra small mobile devices */
        @media (max-width: 480px) {
            .page-title {
                font-size: 1.5rem;
            }

            /* Single column for option grids on very small screens */
            .option-grid-4 {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 1rem;
            }

            .option-box {
                padding: 0.875rem;
            }

            .option-box h4 {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        function App() {
            const [step, setStep] = useState(1);
            const [inputMethod, setInputMethod] = useState(null);
            const [details, setDetails] = useState({
                names: '',
                fullName: '',
                initials: '',
                occasion: 'wedding',
                tone: 'warm',
                design: 'solid',
                color: '#F8F6F3',
                font: 'dancing',
                sealDesign: 'classic',
                selectedSealVariation: 0,
                returnAddr: '',
                returnAddr2: '',
                returnCity: '',
                returnState: '',
                returnZip: ''
            });
            const [guests, setGuests] = useState([]);
            const [currentGuest, setCurrentGuest] = useState({
                firstName: '', lastName: '', firstName2: '', lastName2: '', gift: '', memo: '', relationship: '', addr: '', addr2: '', city: '', state: '', zip: ''
            });
            const [notes, setNotes] = useState([]);
            const [editingNoteIndex, setEditingNoteIndex] = useState(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [generationProgress, setGenerationProgress] = useState({ current: 0, total: 0 });
            const [dragOver, setDragOver] = useState(false);
            const [nearbyShops, setNearbyShops] = useState([]);
            const [addressSuggestions, setAddressSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [guestAddressSuggestions, setGuestAddressSuggestions] = useState([]);
            const [showGuestSuggestions, setShowGuestSuggestions] = useState(false);
            const [sealVariations, setSealVariations] = useState([]);
            const fileInputRef = useRef(null);

            const occasions = {
                wedding: 'üíç Wedding',
                baby_shower: 'üë∂ Baby Shower',
                birthday: 'üéÇ Birthday',
                graduation: 'üéì Graduation',
                anniversary: 'üíï Anniversary',
                general: 'üéÅ General'
            };

            const tones = [
                { id: 'formal', name: 'Formal' },
                { id: 'warm', name: 'Warm' },
                { id: 'casual', name: 'Casual' },
                { id: 'heartfelt', name: 'Heartfelt' },
                { id: 'friendly', name: 'Friendly' },
                { id: 'elegant', name: 'Elegant' },
                { id: 'playful', name: 'Playful' },
                { id: 'sincere', name: 'Sincere' }
            ];

            const colorPresets = [
                { name: 'Cream', value: '#F8F6F3' },
                { name: 'White', value: '#FFFFFF' },
                { name: 'Blush', value: '#FFE4E1' },
                { name: 'Mint', value: '#E8F3E8' },
                { name: 'Lavender', value: '#F0E6FF' },
                { name: 'Sky', value: '#E3F2FD' },
                { name: 'Peach', value: '#FFE5CC' },
                { name: 'Sage', value: '#D4E4D0' }
            ];

            const fonts = [
                { id: 'times', name: 'Times' },
                { id: 'dancing', name: 'Dancing Script' },
                { id: 'caveat', name: 'Caveat' },
                { id: 'kalam', name: 'Kalam (Handwritten)' },
                { id: 'vibes', name: 'Great Vibes' },
                { id: 'satisfy', name: 'Satisfy' },
                { id: 'palatino', name: 'Palatino' },
                { id: 'garamond', name: 'Garamond' }
            ];

            const patterns = [
                { id: 'solid', name: 'Solid' },
                { id: 'stripes', name: 'Stripes' },
                { id: 'dots', name: 'Dots' },
                { id: 'floral', name: 'Floral' },
                { id: 'hearts', name: 'Hearts' },
                { id: 'diamonds', name: 'Diamonds' },
                { id: 'waves', name: 'Waves' },
                { id: 'grid', name: 'Grid' }
            ];

            const sealDesigns = [
                { id: 'classic', name: 'Classic Border' },
                { id: 'double', name: 'Double Ring' },
                { id: 'ornate', name: 'Ornate Dots' },
                { id: 'scalloped', name: 'Scalloped Edge' },
                { id: 'botanical', name: 'Botanical' },
                { id: 'vintage', name: 'Vintage Dashed' },
                { id: 'art-deco', name: 'Art Deco' },
                { id: 'minimal', name: 'Minimal Line' }
            ];

            // Generate 5 seal variations based on occasion
            const generateSealVariations = () => {
                const getInitials = (n) => {
                    const parts = n.split(/[& ]+/);
                    if (parts.length >= 2) return parts[0].charAt(0) + parts[1].charAt(0);
                    return n.substring(0, 2);
                };
                const initials = (details.initials || getInitials(details.names)).toUpperCase();

                // Event-specific icons
                const eventIcons = {
                    wedding: ['üíï', 'üíç', 'üíê', 'ü§ç', '‚ú®'],
                    baby_shower: ['üë∂', 'üçº', 'üéÄ', '‚≠ê', 'üíô'],
                    birthday: ['üéÇ', 'üéâ', 'üéà', 'üéÅ', '‚ú®'],
                    graduation: ['üéì', 'üìö', '‚≠ê', 'üåü', 'üéä'],
                    anniversary: ['üíï', 'üíê', 'ü•Ç', 'üíù', '‚ú®'],
                    general: ['‚ú®', 'üí´', '‚≠ê', 'üåü', 'üíù']
                };

                const icons = eventIcons[details.occasion] || eventIcons.general;
                const designs = ['double', 'ornate', 'botanical', 'scalloped', 'art-deco'];

                return icons.map((icon, i) => ({
                    id: i,
                    initials: initials,
                    icon: icon,
                    design: designs[i],
                    name: `Option ${i + 1}`
                }));
            };

            // Address autocomplete simulation (in production, use Google Places API)
            const handleAddressInput = async (value, field) => {
                setDetails({...details, [field]: value});

                if (field === 'returnAddr' && value.length > 3) {
                    try {
                        // Call Google Places Autocomplete via Netlify function
                        const response = await fetch('/.netlify/functions/autocomplete-address', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                input: value
                            })
                        });

                        if (!response.ok) {
                            throw new Error('Failed to get address suggestions');
                        }

                        const data = await response.json();

                        if (data.predictions && data.predictions.length > 0) {
                            setAddressSuggestions(data.predictions.map(p => ({
                                description: p.description,
                                placeId: p.place_id
                            })));
                            setShowSuggestions(true);
                        } else {
                            setShowSuggestions(false);
                        }
                    } catch (error) {
                        console.error('Error fetching address suggestions:', error);
                        // Fallback to no suggestions on error
                        setShowSuggestions(false);
                    }
                } else {
                    setShowSuggestions(false);
                }
            };

            const handleAddressSelect = async (suggestion) => {
                try {
                    // Call Google Places Details API to get address components
                    const response = await fetch('/.netlify/functions/place-details', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            placeId: suggestion.placeId
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to get place details');
                    }

                    const data = await response.json();

                    if (data.result && data.result.address_components) {
                        const components = data.result.address_components;

                        // Parse address components
                        let streetNumber = '';
                        let route = '';
                        let city = '';
                        let state = '';
                        let zip = '';

                        components.forEach(component => {
                            if (component.types.includes('street_number')) {
                                streetNumber = component.long_name;
                            }
                            if (component.types.includes('route')) {
                                route = component.long_name;
                            }
                            if (component.types.includes('locality')) {
                                city = component.long_name;
                            }
                            if (component.types.includes('administrative_area_level_1')) {
                                state = component.short_name;
                            }
                            if (component.types.includes('postal_code')) {
                                zip = component.long_name;
                            }
                        });

                        // Update details with parsed address
                        setDetails({
                            ...details,
                            returnAddr: `${streetNumber} ${route}`.trim(),
                            returnCity: city,
                            returnState: state,
                            returnZip: zip
                        });
                    } else {
                        // Fallback: just use the description
                        setDetails({...details, returnAddr: suggestion.description});
                    }

                    setShowSuggestions(false);
                } catch (error) {
                    console.error('Error getting place details:', error);
                    // Fallback: just use the description
                    setDetails({...details, returnAddr: suggestion.description});
                    setShowSuggestions(false);
                }
            };

            const handleGuestAddressInput = async (value) => {
                setCurrentGuest({...currentGuest, addr: value});

                if (value.length > 3) {
                    try {
                        const response = await fetch('/.netlify/functions/autocomplete-address', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                input: value
                            })
                        });

                        if (!response.ok) {
                            throw new Error('Failed to get address suggestions');
                        }

                        const data = await response.json();

                        if (data.predictions && data.predictions.length > 0) {
                            setGuestAddressSuggestions(data.predictions.map(p => ({
                                description: p.description,
                                placeId: p.place_id
                            })));
                            setShowGuestSuggestions(true);
                        } else {
                            setShowGuestSuggestions(false);
                        }
                    } catch (error) {
                        console.error('Error fetching guest address suggestions:', error);
                        setShowGuestSuggestions(false);
                    }
                } else {
                    setShowGuestSuggestions(false);
                }
            };

            const handleGuestAddressSelect = async (suggestion) => {
                try {
                    const response = await fetch('/.netlify/functions/place-details', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            placeId: suggestion.placeId
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to get place details');
                    }

                    const data = await response.json();

                    if (data.result && data.result.address_components) {
                        const components = data.result.address_components;

                        let streetNumber = '';
                        let route = '';
                        let city = '';
                        let state = '';
                        let zip = '';

                        components.forEach(component => {
                            if (component.types.includes('street_number')) {
                                streetNumber = component.long_name;
                            }
                            if (component.types.includes('route')) {
                                route = component.long_name;
                            }
                            if (component.types.includes('locality')) {
                                city = component.long_name;
                            }
                            if (component.types.includes('administrative_area_level_1')) {
                                state = component.short_name;
                            }
                            if (component.types.includes('postal_code')) {
                                zip = component.long_name;
                            }
                        });

                        setCurrentGuest({
                            ...currentGuest,
                            addr: `${streetNumber} ${route}`.trim(),
                            city: city,
                            state: state,
                            zip: zip
                        });
                    } else {
                        setCurrentGuest({...currentGuest, addr: suggestion.description});
                    }

                    setShowGuestSuggestions(false);
                } catch (error) {
                    console.error('Error getting guest place details:', error);
                    setCurrentGuest({...currentGuest, addr: suggestion.description});
                    setShowGuestSuggestions(false);
                }
            };

            // Find nearby print shops based on address
            const findNearbyShops = async () => {
                const address = `${details.returnAddr}, ${details.returnCity}, ${details.returnState}`;
                
                // Simulate finding nearby shops (in production, use Google Places API)
                // For now, showing generic nearby locations
                const shops = [
                    {
                        name: 'FedEx Office',
                        distance: '0.8 miles',
                        address: '123 Main St',
                        phone: '(555) 123-4567',
                        url: 'https://www.fedex.com/en-us/printing.html'
                    },
                    {
                        name: 'Staples Print & Marketing',
                        distance: '1.2 miles',
                        address: '456 Oak Ave',
                        phone: '(555) 234-5678',
                        url: 'https://www.staples.com/services/printing/'
                    },
                    {
                        name: 'The UPS Store',
                        distance: '1.5 miles',
                        address: '789 Elm St',
                        phone: '(555) 345-6789',
                        url: 'https://www.theupsstore.com/print'
                    }
                ];
                
                setNearbyShops(shops);
            };

            useEffect(() => {
                if (step === 5 && details.returnAddr && details.returnCity) {
                    findNearbyShops();
                }
            }, [step]);

            const generateNote = (g) => {
                const occ = occasions[details.occasion].replace(/[^\w\s]/g, '').trim().toLowerCase();
                const tone = details.tone || 'warm';

                // Determine if this is the sender's event or the recipient's event
                const isRecipientEvent = ['birthday', 'graduation', 'baby_shower'].includes(details.occasion);
                const eventPossessive = isRecipientEvent ? 'your' : 'our';

                // Helper to integrate personal memo naturally into a sentence
                const integrateMemo = (memo) => {
                    if (!memo || !memo.trim()) return '';

                    const m = memo.trim();
                    // Check if it already starts with a capital and ends with punctuation (complete sentence)
                    const isCompleteSentence = /^[A-Z]/.test(m) && /[.!?]$/.test(m);
                    if (isCompleteSentence) return ' ' + m;

                    // Add "Your" before the memo and make it a complete sentence
                    return ` Your ${m.toLowerCase()}${/[.!?]$/.test(m) ? '' : ' was such a special moment.'}`;
                };

                // Helper function to detect if gift needs article and determine singular/plural
                const formatGift = (giftText) => {
                    if (!giftText) return null;

                    const gift = giftText.trim();

                    // Check if already has article
                    const hasArticle = /^(the|a|an|your|our|this|that|these|those)\s/i.test(gift);

                    // Determine if plural by checking common plural patterns
                    const lowerGift = gift.toLowerCase();
                    const isPlural = lowerGift.match(/s$|ves$|ies$|es$/) &&
                                    !lowerGift.match(/ss$|glass$|dress$/) ||
                                    lowerGift.includes(' and ') ||
                                    lowerGift.match(/^(several|many|some|multiple|both|two|three|four|five|six|seven|eight|nine|ten)/);

                    // If has article, use as-is
                    if (hasArticle) {
                        return { text: gift, plural: isPlural };
                    }

                    // Add appropriate article
                    if (isPlural) {
                        return { text: `the ${gift}`, plural: true };
                    } else {
                        // Singular - use "the" for most gifts
                        return { text: `the ${gift}`, plural: false };
                    }
                };

                // Build the thank you note in a natural, conversational way
                let message = '';

                // Greeting - handle single person or couple
                const firstName1 = (g.firstName || g.name?.split(' ')[0].split(',')[0] || '').trim();
                const firstName2 = (g.firstName2 || '').trim();
                const greeting = firstName2
                    ? `${firstName1} and ${firstName2}`
                    : firstName1;

                const greetings = {
                    formal: `Dear ${greeting},`,
                    warm: `Dear ${greeting},`,
                    casual: `Hi ${greeting},`,
                    heartfelt: `Dear ${greeting},`,
                    friendly: `Hi ${greeting},`,
                    elegant: `Dearest ${greeting},`,
                    playful: `Hey ${greeting},`,
                    sincere: `Dear ${greeting},`
                };
                message += greetings[tone] + '\n\n';

                // Main thank you message - combines attendance + gift naturally
                if (g.gift && g.gift.trim()) {
                    // They gave a gift - thank for both attendance and gift
                    const giftInfo = formatGift(g.gift);
                    const gift = giftInfo.text;
                    const isPlural = giftInfo.plural;

                    const memoIntegration = integrateMemo(g.memo);

                    switch(tone) {
                        case 'formal':
                            message += isRecipientEvent
                                ? `Thank you for the generous gift of ${gift}. Your thoughtfulness is deeply appreciated.${memoIntegration}`
                                : `Thank you for celebrating ${eventPossessive} ${occ} with us and for your generous gift of ${gift}.${memoIntegration} It was wonderful having you share this special day.`;
                            break;
                        case 'warm':
                            message += isRecipientEvent
                                ? `Thank you so much for ${gift} - we love ${isPlural ? 'them' : 'it'}!${memoIntegration} You made ${eventPossessive} ${occ} so special.`
                                : `Thank you for celebrating ${eventPossessive} ${occ} with us! We love ${gift} so much.${memoIntegration} It means the world having you there.`;
                            break;
                        case 'casual':
                            message += isRecipientEvent
                                ? `Thanks for ${gift} - ${isPlural ? "they're" : "it's"} perfect!${memoIntegration} You're the best!`
                                : `Thanks for coming to ${eventPossessive} ${occ}! We love ${gift}.${memoIntegration} So glad you were there!`;
                            break;
                        case 'heartfelt':
                            message += isRecipientEvent
                                ? `Thank you for ${gift}. Your generosity touches our hearts.${memoIntegration}`
                                : `Having you at ${eventPossessive} ${occ} meant so much. Thank you for ${gift}.${memoIntegration} We're so grateful for you.`;
                            break;
                        case 'friendly':
                            message += isRecipientEvent
                                ? `Thank you for ${gift}! We're already using ${isPlural ? 'them' : 'it'} and thinking of you.${memoIntegration}`
                                : `So great having you at ${eventPossessive} ${occ}! Thank you for ${gift}.${memoIntegration} We're already putting ${isPlural ? 'them' : 'it'} to good use.`;
                            break;
                        case 'elegant':
                            message += isRecipientEvent
                                ? `Thank you for the exquisite gift of ${gift}. We are deeply grateful.${memoIntegration}`
                                : `Your presence at ${eventPossessive} ${occ} was a joy. Thank you for the beautiful gift of ${gift}.${memoIntegration}`;
                            break;
                        case 'playful':
                            message += isRecipientEvent
                                ? `Thank you for ${gift} - you nailed it!${memoIntegration} ${eventPossessive.charAt(0).toUpperCase() + eventPossessive.slice(1)} ${occ} was so fun!`
                                : `Thanks for making ${eventPossessive} ${occ} awesome! We love ${gift}.${memoIntegration}`;
                            break;
                        case 'sincere':
                            message += isRecipientEvent
                                ? `Thank you for your thoughtful gift of ${gift}.${memoIntegration} Your kindness means so much.`
                                : `Thank you for being part of ${eventPossessive} ${occ} and for ${gift}.${memoIntegration} We're so glad you were there.`;
                            break;
                    }
                } else {
                    // No gift - focus on presence/wishes + integrate memo
                    const memoIntegration = integrateMemo(g.memo);

                    switch(tone) {
                        case 'formal':
                            message += isRecipientEvent
                                ? `Thank you for your thoughtful wishes on ${eventPossessive} ${occ}.${memoIntegration} Your kindness is deeply appreciated.`
                                : `Thank you for joining us at ${eventPossessive} ${occ}.${memoIntegration} Your presence made it truly special.`;
                            break;
                        case 'warm':
                            message += isRecipientEvent
                                ? `Thank you so much for thinking of us on ${eventPossessive} ${occ}!${memoIntegration} You made our day!`
                                : `Thank you for celebrating ${eventPossessive} ${occ} with us!${memoIntegration} Having you there meant everything.`;
                            break;
                        case 'casual':
                            message += isRecipientEvent
                                ? `Thanks for the birthday wishes!${memoIntegration} You're awesome!`
                                : `Thanks for being at ${eventPossessive} ${occ}!${memoIntegration} It was so great having you there.`;
                            break;
                        case 'heartfelt':
                            message += isRecipientEvent
                                ? `Your thoughtfulness on ${eventPossessive} ${occ} meant the world.${memoIntegration} We're so grateful for you.`
                                : `Having you at ${eventPossessive} ${occ} meant so much.${memoIntegration} We're so grateful for you.`;
                            break;
                        case 'friendly':
                            message += isRecipientEvent
                                ? `Thank you for making ${eventPossessive} ${occ} so special!${memoIntegration}`
                                : `So great celebrating ${eventPossessive} ${occ} with you!${memoIntegration} Your friendship means the world.`;
                            break;
                        case 'elegant':
                            message += isRecipientEvent
                                ? `Thank you for your gracious wishes on ${eventPossessive} ${occ}.${memoIntegration} We are deeply grateful.`
                                : `Your presence at ${eventPossessive} ${occ} was a joy.${memoIntegration} We're so glad you could share this day.`;
                            break;
                        case 'playful':
                            message += isRecipientEvent
                                ? `Thanks for making ${eventPossessive} ${occ} awesome!${memoIntegration} You rock!`
                                : `So glad you came to ${eventPossessive} ${occ}!${memoIntegration} You made it so fun!`;
                            break;
                        case 'sincere':
                            message += isRecipientEvent
                                ? `Thank you for your kindness on ${eventPossessive} ${occ}.${memoIntegration} It meant so much.`
                                : `Thank you for being part of ${eventPossessive} ${occ}.${memoIntegration} We're so glad you were there.`;
                            break;
                    }
                }

                // Personal memo integrated earlier in message body

                message += '\n\n';

                // Closing sentiment
                switch(tone) {
                    case 'formal':
                        message += `We hope to see you again soon.`;
                        break;
                    case 'warm':
                        message += `We can't wait to see you again soon!`;
                        break;
                    case 'casual':
                        message += `Let's get together again soon!`;
                        break;
                    case 'heartfelt':
                        message += `You hold such a special place in our hearts.`;
                        break;
                    case 'friendly':
                        message += `Looking forward to our next get-together!`;
                        break;
                    case 'elegant':
                        message += `We look forward to our next gathering.`;
                        break;
                    case 'playful':
                        message += `Catch you soon!`;
                        break;
                    case 'sincere':
                        message += `We truly hope to see you again very soon.`;
                        break;
                }

                message += '\n\n';

                // Add relationship closing if provided
                const relationshipClosing = g.relationship
                    ? ` You're such a wonderful ${g.relationship.toLowerCase()}.`
                    : '';

                // Sign-off
                const signoffs = {
                    formal: `With sincere gratitude,`,
                    warm: `With love,`,
                    casual: `Love,`,
                    heartfelt: `All our love,`,
                    friendly: `Warmly,`,
                    elegant: `With gratitude,`,
                    playful: `Hugs,`,
                    sincere: `With warmest regards,`
                };

                message += relationshipClosing + '\n\n' + signoffs[tone] + '\n' + details.names;

                return message;
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const parsed = results.data.map((r, i) => {
                            // Support new firstName/lastName format
                            const firstName = r.Guest1FirstName || r.FirstName || r['First Name'] || '';
                            const lastName = r.Guest1LastName || r.LastName || r['Last Name'] || '';
                            const firstName2 = r.Guest2FirstName || r.FirstName2 || r['First Name 2'] || '';
                            const lastName2 = r.Guest2LastName || r.LastName2 || r['Last Name 2'] || '';

                            // Backwards compatibility with old 'Name' column
                            const name = r.Name || r.name || r['Guest Name'] || '';

                            return {
                                id: Date.now() + i,
                                firstName: firstName,
                                lastName: lastName,
                                firstName2: firstName2,
                                lastName2: lastName2,
                                name: name, // Keep for backwards compatibility
                                gift: r.Gift || r.gift || r['Gift Description'] || '',
                                memo: r.Memo || r.memo || r['Special Memory'] || r['Special Moment'] || '',
                                relationship: r.Relationship || r.relationship || r['Relation'] || '',
                                addr: r.Address || r.address || r.addr || r['Street Address'] || '',
                                addr2: r.Address2 || r.address2 || r.addr2 || r['Apartment'] || r['Unit'] || '',
                                city: r.City || r.city || '',
                                state: r.State || r.state || '',
                                zip: r.Zip || r.ZIP || r.zip || r['Zip Code'] || ''
                            };
                        }).filter(g => g.firstName || g.name); // Accept either format
                        setGuests(parsed);
                        setInputMethod('bulk');
                    }
                });
            };

            const handleDragOver = (e) => {
                e.preventDefault();
                setDragOver(true);
            };

            const handleDragLeave = (e) => {
                e.preventDefault();
                setDragOver(false);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setDragOver(false);

                const files = e.dataTransfer.files;
                if (files.length > 0 && files[0].name.endsWith('.csv')) {
                    Papa.parse(files[0], {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            const parsed = results.data.map((r, i) => {
                                // Support new firstName/lastName format
                                const firstName = r.Guest1FirstName || r.FirstName || r['First Name'] || '';
                                const lastName = r.Guest1LastName || r.LastName || r['Last Name'] || '';
                                const firstName2 = r.Guest2FirstName || r.FirstName2 || r['First Name 2'] || '';
                                const lastName2 = r.Guest2LastName || r.LastName2 || r['Last Name 2'] || '';

                                // Backwards compatibility with old 'Name' column
                                const name = r.Name || r.name || r['Guest Name'] || '';

                                return {
                                    id: Date.now() + i,
                                    firstName: firstName,
                                    lastName: lastName,
                                    firstName2: firstName2,
                                    lastName2: lastName2,
                                    name: name, // Keep for backwards compatibility
                                    gift: r.Gift || r.gift || r['Gift Description'] || '',
                                    memo: r.Memo || r.memo || r['Special Memory'] || r['Special Moment'] || '',
                                    relationship: r.Relationship || r.relationship || r['Relation'] || '',
                                    addr: r.Address || r.address || r.addr || r['Street Address'] || '',
                                    addr2: r.Address2 || r.address2 || r.addr2 || r['Apartment'] || r['Unit'] || '',
                                    city: r.City || r.city || '',
                                    state: r.State || r.state || '',
                                    zip: r.Zip || r.ZIP || r.zip || r['Zip Code'] || ''
                                };
                            }).filter(g => g.firstName || g.name); // Accept either format
                            setGuests(parsed);
                            setInputMethod('bulk');
                        }
                    });
                }
            };

            // Helper to format guest names for display
            const formatGuestName = (guest) => {
                // Handle new format (firstName/lastName)
                if (guest.firstName && guest.lastName) {
                    if (guest.firstName2 && guest.lastName2) {
                        // Both guests have same last name
                        if (guest.lastName === guest.lastName2) {
                            return `${guest.firstName} and ${guest.firstName2} ${guest.lastName}`;
                        }
                        // Different last names
                        return `${guest.firstName} ${guest.lastName} and ${guest.firstName2} ${guest.lastName2}`;
                    }
                    return `${guest.firstName} ${guest.lastName}`;
                }
                // Backwards compatibility with old 'name' field
                return guest.name || '';
            };

            const addGuest = () => {
                if (!currentGuest.firstName || !currentGuest.lastName) return;
                setGuests([...guests, { ...currentGuest, id: Date.now() }]);
                setCurrentGuest({
                    firstName: '', lastName: '', firstName2: '', lastName2: '', gift: '', memo: '', relationship: '', addr: '', addr2: '', city: '', state: '', zip: ''
                });
            };

            const deleteGuest = (id) => {
                setGuests(guests.filter(g => g.id !== id));
            };

            const generateNoteWithAI = async (guest) => {
                const guestName = guest.firstName
                    ? (guest.firstName2 ? `${guest.firstName} and ${guest.firstName2}` : guest.firstName)
                    : guest.name?.split(' ')[0].split(',')[0];

                console.log('Generating AI note for:', guestName);

                try {
                    const firstName1 = (guest.firstName || guest.name?.split(' ')[0].split(',')[0] || '').trim();
                    const firstName2 = (guest.firstName2 || '').trim();
                    const greeting = firstName2 ? `${firstName1} and ${firstName2}` : firstName1;

                    const isRecipientEvent = ['birthday', 'graduation', 'baby_shower'].includes(details.occasion);
                    const eventType = occasions[details.occasion].replace(/[^\w\s]/g, '').trim();

                    const prompt = `üö® CRITICAL INSTRUCTION üö®
You are writing thank you note #${guests.indexOf(guest) + 1}. Each note you write MUST be COMPLETELY DIFFERENT from the previous ones. If you wrote "Thank you for celebrating" in the last note, use a COMPLETELY DIFFERENT opening this time (e.g., "We're so grateful you joined us" or "${greeting}, having you at our ${eventType} meant everything" or "Your presence at our celebration was the best gift").

NEVER repeat the same sentence structure, phrases, or patterns. Write as if each note is from a different person with a unique voice.

RECIPIENT INFO:
- Name: ${greeting}${firstName2 ? ' (couple)' : ''}
- Gift: ${guest.gift || 'no physical gift, just their presence'}
- Special moment: ${guest.memo || 'none mentioned'}
- Relationship: ${guest.relationship || 'guest'}
- Event: ${isRecipientEvent ? `${firstName1}'s ${eventType} (use "your ${eventType}")` : `Our ${eventType} (use "our ${eventType}")`}
- Tone: ${details.tone}
- Sign from: ${details.names}

‚ö†Ô∏è CRITICAL - READ CAREFULLY:
- GIFT CAPITALIZATION: The gift name is "${guest.gift || 'no physical gift, just their presence'}". You MUST use this EXACT capitalization in your message. If it's lowercase (like "picture frame"), keep it lowercase. Do NOT write "Picture Frame" or "Picture frame". Only capitalize if it's a proper noun (like "Nintendo" or "Dyson"). Examples:
  * If gift is "picture frame" ‚Üí write "the picture frame" (NOT "the Picture Frame")
  * If gift is "kitchen towels" ‚Üí write "the kitchen towels" (NOT "the Kitchen Towels")
  * If gift is "Instant Pot" ‚Üí write "the Instant Pot" (this is a brand name, keep capitals)
- EVENT: Use lowercase "your" or "our" (not "YOUR" or "OUR"), e.g., "your baby shower" not "YOUR Baby Shower".

MANDATORY UNIQUENESS REQUIREMENTS:

1. GREETING FORMAT - CRITICAL:
   Write the greeting on its own line, then start the message on the next line:
   "${greeting}," (on its own line)
   Then the message starts below it.

   Match tone: formal/warm/heartfelt/elegant/sincere: "Dear ${greeting}," / casual/friendly: "Hi ${greeting}," / playful: "Hey ${greeting},"

2. VARY YOUR OPENING - Never start with "Thank you for celebrating" twice:
   Examples: "We're so grateful you joined us" / "Your presence meant the world" / "Having you there made our day complete" / "What a joy it was to celebrate with you" / "We loved having you share our special day"

3. TALK ABOUT THE GIFT DIFFERENTLY each time:
   ${guest.gift ? `
   - DON'T say "We love the ${guest.gift} so much" - that's generic
   - Instead, describe HOW you'll use it, WHY it's perfect, WHAT it means to you
   - Examples: "The ${guest.gift} will have such a special place in our home" / "Every time we use the ${guest.gift}, we'll think of you" / "You chose the perfect ${guest.gift} - it's exactly what we needed" / "The ${guest.gift} is absolutely beautiful and so thoughtful"
   ` : '- Focus on how much their attendance meant, be specific about what they brought to the celebration'}

4. WEAVE IN THE SPECIAL MOMENT NATURALLY - Don't use "was such a special moment":
   ${guest.memo ? `
   - The memo is: "${guest.memo}"
   - DON'T say "Your ${guest.memo} was such a special moment"
   - Instead, integrate it naturally: "We'll never forget ${guest.memo}" / "${guest.memo} touched our hearts" / "The way you ${guest.memo} meant so much to us" / "We're still talking about ${guest.memo}"
   ` : ''}

5. VARY HOW YOU CLOSE - Don't repeat "We can't wait to see you again soon":
   Examples: "Let's get together soon" / "Looking forward to our next visit" / "Hope to see you again before too long" / "Can't wait for the next time we're all together" / "We need to plan a get-together soon" / "See you soon, we hope"

6. RELATIONSHIP ACKNOWLEDGMENT - Don't just say "You're such a wonderful ${guest.relationship}":
   ${guest.relationship ? `
   Examples: "Having ${guest.relationship} like you means everything" / "We're so lucky to have you in our lives" / "Your ${guest.relationship} is such a blessing to us" / "We treasure your ${guest.relationship}" / "You're the kind of ${guest.relationship} everyone wishes for"
   ` : ''}

7. MATCH TONE "${details.tone}":
   ${details.tone === 'formal' ? 'Professional, respectful, proper' :
     details.tone === 'warm' ? 'Loving, affectionate, tender' :
     details.tone === 'casual' ? 'Relaxed, conversational' :
     details.tone === 'heartfelt' ? 'Emotional, sincere, touching' :
     details.tone === 'friendly' ? 'Upbeat, cheerful, personable' :
     details.tone === 'elegant' ? 'Refined, graceful, sophisticated' :
     details.tone === 'playful' ? 'Fun, light, cheerful' :
     'Honest, genuine, authentic'}

8. SIGN-OFF (match tone):
   ${details.tone === 'formal' ? '"With sincere gratitude,"' :
     details.tone === 'warm' ? '"With love," or "Love always,"' :
     details.tone === 'casual' ? '"Love," or "XO,"' :
     details.tone === 'heartfelt' ? '"All our love," or "With all our hearts,"' :
     details.tone === 'friendly' ? '"Warmly," or "With warmth,"' :
     details.tone === 'elegant' ? '"With gratitude," or "Gratefully,"' :
     details.tone === 'playful' ? '"Hugs," or "XOXO,"' :
     '"With warmest regards," or "Sincerely,"'}
   ${details.names}

WRITE THE NOTE NOW - INCLUDE ALL PARTS:
1. Greeting on its own line: "${greeting}," or "Dear ${greeting}," or "Hi ${greeting},"
2. Message body (4-6 sentences) - start on next line after greeting
3. Sign-off line: ${details.tone === 'formal' ? '"With sincere gratitude,"' :
     details.tone === 'warm' ? '"With love,"' :
     details.tone === 'casual' ? '"Love,"' :
     details.tone === 'heartfelt' ? '"All our love,"' :
     details.tone === 'friendly' ? '"Warmly,"' :
     details.tone === 'elegant' ? '"With gratitude,"' :
     details.tone === 'playful' ? '"Hugs,"' :
     '"With warmest regards,"'}
4. Your name on the last line: ${details.names}

Make it completely unique from previous notes with natural flow!`;

                    console.log('Calling Claude API via Netlify function for:', firstName);

                    // Call our secure Netlify function instead of Claude API directly
                    const response = await fetch('/.netlify/functions/generate-message', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            prompt: prompt
                        })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('Claude API error:', errorText);
                        console.error('Full error response:', errorText);
                        // Don't show alert for every guest, just log it
                        return generateNote(guest); // Fallback to template
                    }

                    const data = await response.json();
                    const generatedNote = data.content[0].text.trim();
                    console.log('Generated unique note for', firstName, ':', generatedNote.substring(0, 100));
                    return generatedNote;
                } catch (error) {
                    console.error('Error generating note with AI:', error);
                    console.error('Error details:', error.message);
                    // Don't show alert, just use fallback
                    return generateNote(guest); // Fallback to template
                }
            };

            const handleGenerate = async () => {
                if (!guests.length) {
                    alert('Please add guests first!');
                    return;
                }

                setIsGenerating(true);
                setGenerationProgress({ current: 0, total: guests.length });

                try {
                    const generated = [];
                    for (let i = 0; i < guests.length; i++) {
                        const g = guests[i];
                        setGenerationProgress({ current: i + 1, total: guests.length });
                        const content = await generateNoteWithAI(g);
                        generated.push({
                            guestName: formatGuestName(g),
                            gift: g.gift,
                            content: content,
                            addr: g.addr,
                            addr2: g.addr2 || '',
                            city: g.city,
                            state: g.state,
                            zip: g.zip
                        });
                    }

                    setNotes(generated);
                    setIsGenerating(false);
                    setStep(5); // Go to review/edit messages
                } catch (error) {
                    alert('Error generating notes. Please try again.');
                    console.error(error);
                    setIsGenerating(false);
                }
            };

            const generateCardsPDF = async () => {
                const { jsPDF } = window.jspdf;
                // Standard 8.5" x 11" page with 4 postcards (Avery 5389 format)
                const pdf = new jsPDF({ orientation: 'portrait', unit: 'in', format: 'letter' });

                // Show loading message
                const generateButton = event.target;
                const originalText = generateButton ? generateButton.textContent : '';
                if (generateButton) {
                    generateButton.innerHTML = '‚è≥ Generating PDF...';
                    generateButton.disabled = true;
                    generateButton.style.opacity = '0.7';
                }

                try {
                    // Create a temporary container for rendering cards
                    const tempContainer = document.createElement('div');
                    tempContainer.style.position = 'fixed';
                    tempContainer.style.left = '-9999px';
                    tempContainer.style.top = '0';
                    document.body.appendChild(tempContainer);

                    // Avery 5389 layout: 2 columns x 2 rows
                    // Each card is 5.5" x 4.25" but we need to fit 2 across (8.5" page)
                    const cardWidth = 4.25;  // Portrait orientation
                    const cardHeight = 5.5;  // Portrait orientation
                    const marginX = 0;       // No horizontal margin for Avery 5389
                    const marginY = 0;       // No vertical margin for Avery 5389

                    for (let i = 0; i < notes.length; i++) {
                        const note = notes[i];
                        const positionOnPage = i % 4;

                        // Add new page every 4 cards
                        if (i > 0 && positionOnPage === 0) {
                            pdf.addPage();
                        }

                        // Create a card element with actual HTML/CSS
                        const cardElement = document.createElement('div');
                        cardElement.style.width = '637px'; // 4.25 inches * 150 DPI
                        cardElement.style.height = '825px'; // 5.5 inches * 150 DPI
                        cardElement.style.backgroundColor = details.color;
                        cardElement.style.padding = '75px';
                        cardElement.style.boxSizing = 'border-box';
                        cardElement.style.fontFamily = `'${details.font === 'times' ? 'Times New Roman' : details.font === 'dancing' ? 'Dancing Script' : details.font === 'caveat' ? 'Caveat' : details.font === 'kalam' ? 'Kalam' : details.font === 'vibes' ? 'Great Vibes' : details.font === 'satisfy' ? 'Satisfy' : details.font === 'palatino' ? 'Palatino Linotype' : 'Garamond'}', ${details.font.includes('dancing') || details.font.includes('vibes') || details.font.includes('satisfy') || details.font.includes('caveat') || details.font.includes('kalam') ? 'cursive' : 'serif'}`;
                        cardElement.style.fontSize = '18px';
                        cardElement.style.color = '#282828';
                        cardElement.style.whiteSpace = 'pre-line';
                        cardElement.style.lineHeight = '1.6';
                        cardElement.style.position = 'relative';

                        // Add pattern overlay if needed
                        if (details.design === 'floral') {
                            const floralPattern = `
                                radial-gradient(circle at 10% 20%, rgba(0,0,0,0.06) 2px, transparent 2px),
                                radial-gradient(circle at 30% 15%, rgba(0,0,0,0.06) 2px, transparent 2px),
                                radial-gradient(circle at 25% 25%, rgba(0,0,0,0.06) 2px, transparent 2px),
                                radial-gradient(circle at 15% 30%, rgba(0,0,0,0.06) 2px, transparent 2px),
                                radial-gradient(circle at 20% 35%, rgba(0,0,0,0.06) 2px, transparent 2px)
                            `;
                            cardElement.style.background = `${floralPattern}, ${details.color}`;
                            cardElement.style.backgroundSize = '80px 80px';
                        } else if (details.design === 'dots') {
                            cardElement.style.background = `radial-gradient(circle, rgba(0,0,0,0.08) 2px, transparent 2px) ${details.color}`;
                            cardElement.style.backgroundSize = '45px 45px';
                        } else if (details.design === 'stripes') {
                            cardElement.style.background = `repeating-linear-gradient(90deg, transparent, transparent 44px, rgba(0,0,0,0.05) 44px, rgba(0,0,0,0.05) 45px) ${details.color}`;
                        } else if (details.design === 'hearts') {
                            cardElement.style.background = `radial-gradient(circle at 25% 25%, rgba(255,192,203,0.3) 5%, transparent 20%), radial-gradient(circle at 75% 75%, rgba(255,192,203,0.3) 5%, transparent 20%), ${details.color}`;
                            cardElement.style.backgroundSize = '60px 60px';
                        } else if (details.design === 'diamonds') {
                            cardElement.style.background = `linear-gradient(45deg, rgba(0,0,0,0.05) 25%, transparent 25%), linear-gradient(-45deg, rgba(0,0,0,0.05) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.05) 75%), linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.05) 75%), ${details.color}`;
                            cardElement.style.backgroundSize = '45px 45px';
                            cardElement.style.backgroundPosition = '0 0, 0 22.5px, 22.5px -22.5px, -22.5px 0px';
                        } else if (details.design === 'waves') {
                            cardElement.style.background = `repeating-linear-gradient(0deg, transparent, transparent 45px, rgba(0,0,0,0.03) 45px, rgba(0,0,0,0.03) 46px) ${details.color}`;
                        } else if (details.design === 'grid') {
                            cardElement.style.background = `linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px), ${details.color}`;
                            cardElement.style.backgroundSize = '30px 30px';
                        }

                        // Clean up content: remove horizontal rules, excessive line breaks
                        let cleanedContent = note.content
                            .replace(/[-_*]{3,}/g, '')  // Remove horizontal rules (---, ___, ***)
                            .replace(/\n{3,}/g, '\n\n')  // Remove excessive line breaks
                            .trim();
                        cardElement.innerText = cleanedContent;

                        tempContainer.appendChild(cardElement);

                        // Convert to canvas then to image
                        const canvas = await html2canvas(cardElement, {
                            scale: 2,
                            backgroundColor: details.color,
                            logging: false
                        });

                        const imgData = canvas.toDataURL('image/jpeg', 1.0);

                        // Calculate position on page (2x2 grid)
                        const col = positionOnPage % 2;
                        const row = Math.floor(positionOnPage / 2);
                        const x = marginX + (col * cardWidth);
                        const y = marginY + (row * cardHeight);

                        pdf.addImage(imgData, 'JPEG', x, y, cardWidth, cardHeight);

                        tempContainer.removeChild(cardElement);
                    }

                    // Clean up
                    document.body.removeChild(tempContainer);

                    pdf.save('thank-you-cards.pdf');

                    if (generateButton) {
                        generateButton.innerHTML = originalText;
                        generateButton.disabled = false;
                        generateButton.style.opacity = '1';
                    }
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF. Please try again.');
                    if (generateButton) {
                        generateButton.innerHTML = originalText;
                        generateButton.disabled = false;
                        generateButton.style.opacity = '1';
                    }
                }
            };

            const generateRecipientLabelsPDF = () => {
                try {
                    const { jsPDF } = window.jspdf;
                    const withAddr = notes.filter(n => n.addr && n.city);

                    if (!withAddr.length) {
                        alert('No guest addresses found! Make sure to add addresses for your guests.');
                        return;
                    }

                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'in',
                        format: 'letter'
                    });

                    // Avery 5160: 3 columns x 10 rows = 30 labels per page
                    const labelW = 2.625, labelH = 1, cols = 3, marginL = 0.1875, marginT = 0.5;
                    const gapX = 0.125;

                    withAddr.forEach((note, i) => {
                        if (i > 0 && i % 30 === 0) pdf.addPage();
                        const pos = i % 30;
                        const row = Math.floor(pos / cols);
                        const col = pos % cols;
                        const x = marginL + (col * (labelW + gapX));
                        const y = marginT + (row * labelH);

                        pdf.setFontSize(10);
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(0, 0, 0);

                        // Guest name
                        pdf.text(note.guestName || '', x + 0.1, y + 0.3);

                        // Street address
                        let currentY = y + 0.5;
                        if (note.addr) {
                            pdf.text(note.addr, x + 0.1, currentY);
                            currentY += 0.2;
                        }

                        // Apartment/Unit
                        if (note.addr2) {
                            pdf.text(note.addr2, x + 0.1, currentY);
                            currentY += 0.2;
                        }

                        // City, State, ZIP
                        if (note.city && note.state) {
                            pdf.text(`${note.city}, ${note.state} ${note.zip || ''}`, x + 0.1, currentY);
                        }
                    });

                    pdf.save('recipient-labels.pdf');
                    // Success - labels downloaded
                } catch (error) {
                    console.error('Error generating recipient labels:', error);
                    alert('Error generating labels. Please try again.');
                }
            };

            const generateReturnLabelsPDF = () => {
                try {
                    const { jsPDF } = window.jspdf;
                    if (!details.returnAddr || !details.returnCity) {
                        alert('Please add complete return address (street and city required)!');
                        return;
                    }

                    const pdf = new jsPDF({
                        orientation: 'portrait',
                        unit: 'in',
                        format: 'letter'
                    });

                    // Using Avery 5167 format: 4 labels per column, 20 per page (1/2" x 1-3/4")
                    // But we'll use a more standard return label: 3 cols x 10 rows (matching recipient)
                    const labelW = 2.625, labelH = 1, cols = 3, marginL = 0.1875, marginT = 0.5;
                    const gapX = 0.125;
                    const count = Math.max(notes.length, 30);

                    for (let i = 0; i < count; i++) {
                        if (i > 0 && i % 30 === 0) pdf.addPage();
                        const pos = i % 30;
                        const row = Math.floor(pos / cols);
                        const col = pos % cols;
                        const x = marginL + (col * (labelW + gapX));
                        const y = marginT + (row * labelH);

                        pdf.setFontSize(9);
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(0, 0, 0);

                        // Name (use fullName if available, fallback to names)
                        const nameForLabel = details.fullName || details.names;
                        pdf.text(nameForLabel, x + 0.1, y + 0.3);

                        // Street address
                        let currentY = y + 0.5;
                        if (details.returnAddr) {
                            pdf.text(details.returnAddr, x + 0.1, currentY);
                            currentY += 0.2;
                        }

                        // Apartment/Unit
                        if (details.returnAddr2) {
                            pdf.text(details.returnAddr2, x + 0.1, currentY);
                            currentY += 0.2;
                        }

                        // City, State, ZIP
                        pdf.text(`${details.returnCity}, ${details.returnState} ${details.returnZip || ''}`, x + 0.1, currentY);
                    }

                    pdf.save('return-labels.pdf');
                    // Success - labels downloaded
                } catch (error) {
                    console.error('Error generating return labels:', error);
                    alert('Error generating labels. Please try again.');
                }
            };

            const generateSealsPDF = () => {
                const { jsPDF } = window.jspdf;

                // Use the user-provided initials, or fall back to auto-generated
                const getInitials = (n) => {
                    const parts = n.split(/[& ]+/);
                    if (parts.length >= 2) return parts[0].charAt(0) + parts[1].charAt(0);
                    return n.substring(0, 2);
                };
                const initials = (details.initials || getInitials(details.names)).toUpperCase();
                
                const pdf = new jsPDF({
                    unit: 'in',
                    format: 'letter'
                });
                
                const hexToRgb = (hex) => {
                    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return result ? {
                        r: parseInt(result[1], 16),
                        g: parseInt(result[2], 16),
                        b: parseInt(result[3], 16)
                    } : { r: 248, g: 246, b: 243 };
                };
                const color = hexToRgb(details.color);
                
                // Layout for standard 1.5" round sticker sheets (Avery 22807 compatible)
                // 3 columns x 8 rows = 24 seals per page
                const sealDiameter = 1.5;
                const cols = 3;
                const rows = 8;
                const pageWidth = 8.5;
                const pageHeight = 11;

                // Avery 22807 precise specifications
                // 3 columns x 8 rows of 1.5" diameter circles
                // Standard measurements from Avery template
                const horizontalSpacing = 2.8125;  // Distance between circle centers (2.8125")
                const verticalSpacing = 1.375;     // Distance between circle centers (1.375")
                const marginX = 0.9375;            // Left margin to first seal center (15/16")
                const marginY = 0.6875;            // Top margin to first seal center (11/16")
                
                const count = notes.length * 5; // 5 seals per guest
                const sealsPerPage = cols * rows; // 24 seals per page

                for (let i = 0; i < count; i++) {
                    // Add new page every 24 seals
                    if (i > 0 && i % sealsPerPage === 0) {
                        pdf.addPage();
                    }

                    const pos = i % sealsPerPage;
                    const col = pos % cols;
                    const row = Math.floor(pos / cols);

                    const centerX = marginX + (col * horizontalSpacing);
                    const centerY = marginY + (row * verticalSpacing);
                    const radius = sealDiameter / 2;
                    
                    // Background circle
                    pdf.setFillColor(color.r, color.g, color.b);
                    pdf.circle(centerX, centerY, radius, 'F');
                    
                    // Border design
                    const borderColor = {
                        r: Math.max(0, color.r - 40),
                        g: Math.max(0, color.g - 40),
                        b: Math.max(0, color.b - 40)
                    };
                    pdf.setDrawColor(borderColor.r, borderColor.g, borderColor.b);
                    
                    if (details.sealDesign === 'classic') {
                        pdf.setLineWidth(0.025);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                    } else if (details.sealDesign === 'double') {
                        pdf.setLineWidth(0.02);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                        pdf.circle(centerX, centerY, radius - 0.18, 'S');
                    } else if (details.sealDesign === 'ornate') {
                        pdf.setLineWidth(0.025);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                        pdf.setFillColor(borderColor.r, borderColor.g, borderColor.b);
                        for (let angle = 0; angle < 360; angle += 30) {
                            const rad = (angle * Math.PI) / 180;
                            const dotX = centerX + Math.cos(rad) * (radius - 0.18);
                            const dotY = centerY + Math.sin(rad) * (radius - 0.18);
                            pdf.circle(dotX, dotY, 0.025, 'F');
                        }
                    } else if (details.sealDesign === 'scalloped') {
                        pdf.setLineWidth(0.02);
                        const numScallops = 16;
                        for (let angle = 0; angle < 360; angle += 360 / numScallops) {
                            const rad = (angle * Math.PI) / 180;
                            const scX = centerX + Math.cos(rad) * (radius - 0.12);
                            const scY = centerY + Math.sin(rad) * (radius - 0.12);
                            pdf.circle(scX, scY, 0.1, 'S');
                        }
                        pdf.circle(centerX, centerY, radius - 0.25, 'S');
                    } else if (details.sealDesign === 'botanical') {
                        pdf.setLineWidth(0.02);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                        pdf.setFillColor(borderColor.r, borderColor.g, borderColor.b);
                        // Draw small flower shapes around circle (6 flowers)
                        for (let a = 0; a < 360; a += 60) {
                            const rad = (a * Math.PI) / 180;
                            const fx = centerX + Math.cos(rad) * (radius - 0.18);
                            const fy = centerY + Math.sin(rad) * (radius - 0.18);

                            // Draw a 5-petal flower
                            const petalRadius = 0.025;
                            for (let p = 0; p < 5; p++) {
                                const petalAngle = (p * 72) * Math.PI / 180;
                                const px = fx + Math.cos(petalAngle) * 0.03;
                                const py = fy + Math.sin(petalAngle) * 0.03;
                                pdf.circle(px, py, petalRadius, 'F');
                            }
                            // Center of flower
                            pdf.circle(fx, fy, 0.015, 'F');
                        }
                    } else if (details.sealDesign === 'vintage') {
                        pdf.setLineDash([0.04, 0.04]);
                        pdf.setLineWidth(0.03);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                        pdf.setLineDash([]);
                        pdf.setLineWidth(0.02);
                        pdf.circle(centerX, centerY, radius - 0.18, 'S');
                    } else if (details.sealDesign === 'art-deco') {
                        pdf.setLineWidth(0.03);
                        const octRadius = radius - 0.08;
                        const octPoints = [];
                        for (let a = 0; a < 8; a++) {
                            const angle = (a * 45 - 22.5) * Math.PI / 180;
                            octPoints.push([
                                centerX + Math.cos(angle) * octRadius,
                                centerY + Math.sin(angle) * octRadius
                            ]);
                        }
                        for (let p = 0; p < octPoints.length; p++) {
                            const nextP = (p + 1) % octPoints.length;
                            pdf.line(octPoints[p][0], octPoints[p][1], octPoints[nextP][0], octPoints[nextP][1]);
                        }
                        pdf.setFillColor(borderColor.r, borderColor.g, borderColor.b);
                        for (let a = 0; a < 8; a += 2) {
                            const angle = (a * 45 - 22.5) * Math.PI / 180;
                            const dx = centerX + Math.cos(angle) * (octRadius - 0.2);
                            const dy = centerY + Math.sin(angle) * (octRadius - 0.2);
                            pdf.circle(dx, dy, 0.025, 'F');
                        }
                    } else if (details.sealDesign === 'minimal') {
                        pdf.setLineWidth(0.015);
                        pdf.circle(centerX, centerY, radius - 0.08, 'S');
                    }
                    
                    // Initials - use selected font style
                    pdf.setTextColor(50, 50, 50);

                    // Map the selected font to a jsPDF font style for seals
                    const sealFontMapping = {
                        'times': ['times', 'normal', 28],
                        'dancing': ['times', 'italic', 30],
                        'caveat': ['times', 'italic', 28],
                        'kalam': ['times', 'italic', 28],
                        'vibes': ['times', 'italic', 32],
                        'satisfy': ['times', 'italic', 30],
                        'palatino': ['times', 'normal', 28],
                        'garamond': ['times', 'normal', 28]
                    };

                    const [sealFont, sealStyle, sealSize] = sealFontMapping[details.font] || ['helvetica', 'bold', 28];
                    pdf.setFont(sealFont, sealStyle);
                    pdf.setFontSize(sealSize);
                    const textWidth = pdf.getTextWidth(initials);
                    pdf.text(initials, centerX - (textWidth / 2), centerY + 0.1);
                }
                
                pdf.save('envelope-seals.pdf');
            };

            // STEP 1: Hero
            if (step === 1) {
                return (
                    <>
                        <div className="hero-section">
                            <div className="brand-badge">By Brite.co</div>
                            <h1>Thank You Note Generator</h1>
                            <p className="hero-subtitle">Upload Your Guest List. Download Everything.</p>
                            <p className="hero-description">The easiest DIY solution ‚Äî cards, labels & seals ready to print</p>
                            <div style={{
                                background: 'linear-gradient(135deg, #E1E7EF 0%, #F4F7FC 100%)',
                                padding: '1.5rem 2rem',
                                borderRadius: '16px',
                                marginTop: '2rem',
                                display: 'inline-block'
                            }}>
                                <div style={{fontSize: '1.25rem', fontWeight: '600', color: '#008182', marginBottom: '0.5rem'}}>
                                    ‚ú® Always Free to Use
                                </div>
                                <div style={{fontSize: '1rem', color: '#666'}}>
                                    Save $200-500 vs. professional stationery services
                                </div>
                            </div>
                        </div>

                        <div className="how-it-works">
                            <h2>How It Works</h2>
                            <div className="steps-grid">
                                <div className="step">
                                    <div className="step-number">1</div>
                                    <h3>Enter Details</h3>
                                    <p>Add your address & names</p>
                                </div>
                                <div className="step">
                                    <div className="step-number">2</div>
                                    <h3>Add Guests</h3>
                                    <p>CSV or manual entry</p>
                                </div>
                                <div className="step">
                                    <div className="step-number">3</div>
                                    <h3>Customize</h3>
                                    <p>Choose design options</p>
                                </div>
                                <div className="step">
                                    <div className="step-number">4</div>
                                    <h3>Download</h3>
                                    <p>Print locally or online</p>
                                </div>
                            </div>
                            <div className="tip">
                                üí° Use whatever parts you need - cards only, labels only, or the full package!
                            </div>
                        </div>

                        <div className="features-grid">
                            <div className="feature-card">
                                <div className="feature-icon">üíå</div>
                                <h3>Beautiful Cards</h3>
                                <p>5.5" x 4.25" postcards with custom designs</p>
                            </div>
                            <div className="feature-card">
                                <div className="feature-icon">üè∑Ô∏è</div>
                                <h3>Address Labels</h3>
                                <p>Print-ready Avery 5160 format</p>
                            </div>
                            <div className="feature-card">
                                <div className="feature-icon">üí´</div>
                                <h3>Custom Seals</h3>
                                <p>8 design styles with your initials</p>
                            </div>
                        </div>

                        <div style={{textAlign: 'center', margin: '2rem 0'}}>
                            <button
                                onClick={() => setStep(1)}
                                style={{
                                    background: '#FF6B35',
                                    color: 'white',
                                    border: 'none',
                                    padding: '1rem 2.5rem',
                                    fontSize: '1.125rem',
                                    borderRadius: '12px',
                                    cursor: 'pointer',
                                    fontWeight: '600',
                                    transition: 'all 0.3s',
                                    boxShadow: '0 4px 12px rgba(255, 107, 53, 0.3)'
                                }}
                                onMouseOver={(e) => {
                                    e.target.style.background = '#E85A2A';
                                    e.target.style.transform = 'translateY(-2px)';
                                    e.target.style.boxShadow = '0 6px 16px rgba(255, 107, 53, 0.4)';
                                }}
                                onMouseOut={(e) => {
                                    e.target.style.background = '#FF6B35';
                                    e.target.style.transform = 'translateY(0)';
                                    e.target.style.boxShadow = '0 4px 12px rgba(255, 107, 53, 0.3)';
                                }}
                            >
                                Get Started Free ‚Üí
                            </button>
                        </div>

                        <div className="card" style={{maxWidth: '900px', margin: '0 auto 2rem', background: 'linear-gradient(135deg, #E1E7EF 0%, #F4F7FC 100%)'}}>
                            <h3 style={{textAlign: 'center', marginBottom: '1.5rem', color: '#008182'}}>Perfect For Any Occasion</h3>
                            <div style={{display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '2.5rem', flexWrap: 'wrap'}}>
                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                    <span style={{color: '#31D7CA', fontSize: '1.25rem', fontWeight: 'bold'}}>‚úì</span>
                                    <strong style={{color: '#272D3F'}}>Weddings</strong>
                                </div>
                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                    <span style={{color: '#31D7CA', fontSize: '1.25rem', fontWeight: 'bold'}}>‚úì</span>
                                    <strong style={{color: '#272D3F'}}>Baby Showers</strong>
                                </div>
                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                    <span style={{color: '#31D7CA', fontSize: '1.25rem', fontWeight: 'bold'}}>‚úì</span>
                                    <strong style={{color: '#272D3F'}}>Birthdays</strong>
                                </div>
                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                    <span style={{color: '#31D7CA', fontSize: '1.25rem', fontWeight: 'bold'}}>‚úì</span>
                                    <strong style={{color: '#272D3F'}}>Graduations</strong>
                                </div>
                                <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                    <span style={{color: '#31D7CA', fontSize: '1.25rem', fontWeight: 'bold'}}>‚úì</span>
                                    <strong style={{color: '#272D3F'}}>Any Event!</strong>
                                </div>
                            </div>
                        </div>

                        <div className="card" style={{maxWidth: '800px', margin: '0 auto 3rem'}}>
                            <h3 style={{textAlign: 'center', marginBottom: '1.5rem', color: '#008182'}}>Frequently Asked Questions</h3>
                            <div style={{display: 'grid', gap: '1.5rem'}}>
                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>Is this really free?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        Yes! The tool is completely free to use. You'll only pay for supplies (cardstock, labels, envelopes) if you choose to print and mail your cards. Generate as many cards as you need at no cost.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>What events can I create thank you cards for?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        Our AI supports a wide range of occasions including weddings, baby showers, bridal showers, birthdays, graduations, anniversaries, engagement parties, baptisms/christenings, bar/bat mitzvahs, retirement parties, housewarming parties, and general celebrations. Simply select your event type and the AI will tailor the message tone and wording appropriately.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>What do I need to print my cards?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        You'll need Avery 5389 postcard stock (4 postcards per 8.5" x 11" sheet), Avery 5160 address labels, 1.5" round sticker sheets (Avery 22807) for seals, and A2 envelopes (4‚Öú" x 5¬æ"). Links to purchase on Amazon are provided in the download step.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>Can I bulk upload my guest list?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        Absolutely! Upload a CSV file with your guest list. Required columns are Name, Address, City, State, and Zip. Optional columns include Gift, Relationship, and Special Moment for more personalized messages.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>How long does it take to generate cards?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        Each card takes about 3-5 seconds to generate. For 50 guests, expect around 3-4 minutes total. We show a progress bar so you know exactly where you are in the process.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>Is my guest data saved?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        Yes! Your guest list is automatically saved in your browser as you add guests. You can close the page and come back later without losing progress. However, data is only stored locally on your device.
                                    </p>
                                </div>

                                <div>
                                    <h4 style={{color: '#008182', marginBottom: '0.5rem', fontSize: '1.05rem'}}>What if I don't have a printer?</h4>
                                    <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>
                                        No problem! Save your PDFs to a USB drive and take them to any print shop like Staples, FedEx Office, or UPS Store. We even help you find nearby print shops based on your location.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div style={{textAlign: 'center', paddingBottom: '3rem'}}>
                            <button className="btn-primary" onClick={() => setStep(2)}>
                                Get Started - It's Free ‚Üí
                            </button>
                        </div>
                    </>
                );
            }

            // STEP 2: Your Details
            if (step === 2) {
                return (
                    <div className="container">
                        <div className="back-link" onClick={() => setStep(1)}>
                            ‚Üê Back
                        </div>
                        <h2 className="page-title">Your Return Address</h2>
                        <p className="page-subtitle">For return labels and finding nearby print shops</p>

                        <div className="card">
                            <div className="form-section">
                                <label>Name(s) for Return Labels</label>
                                <input
                                    value={details.fullName}
                                    onChange={(e) => setDetails({...details, fullName: e.target.value})}
                                    placeholder="Sarah & Mike Johnson"
                                />
                                <p style={{fontSize: '0.85rem', color: '#666', marginTop: '0.5rem'}}>
                                    Your full name(s) for the return address labels üè∑Ô∏è
                                </p>
                            </div>

                            <div className="form-section">
                                <label>Card Signature</label>
                                <input
                                    value={details.names}
                                    onChange={(e) => setDetails({...details, names: e.target.value})}
                                    placeholder="Sarah & Mike"
                                />
                                <p style={{fontSize: '0.85rem', color: '#666', marginTop: '0.5rem'}}>
                                    How you'd like to sign your cards ‚úçÔ∏è
                                </p>
                            </div>

                            <div className="form-section">
                                <label>Initials for Envelope Seals</label>
                                <input
                                    value={details.initials}
                                    onChange={(e) => setDetails({...details, initials: e.target.value.toUpperCase()})}
                                    placeholder="SM"
                                    maxLength="4"
                                />
                                <p style={{fontSize: '0.85rem', color: '#666', marginTop: '0.5rem'}}>
                                    These will appear on your decorative envelope seals üí´
                                </p>
                            </div>

                            <div className="form-section" style={{position: 'relative'}}>
                                <label>Street Address</label>
                                <input
                                    value={details.returnAddr}
                                    onChange={(e) => handleAddressInput(e.target.value, 'returnAddr')}
                                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                                    placeholder="123 Main Street"
                                />
                                {showSuggestions && addressSuggestions.length > 0 && (
                                    <div className="address-suggestions">
                                        {addressSuggestions.map((addr, i) => (
                                            <div
                                                key={i}
                                                className="address-suggestion"
                                                onClick={() => handleAddressSelect(addr)}
                                            >
                                                {addr.description}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <div className="form-section">
                                <label>Apartment, Suite, Unit (Optional)</label>
                                <input
                                    value={details.returnAddr2}
                                    onChange={(e) => setDetails({...details, returnAddr2: e.target.value})}
                                    placeholder="Apt 4B"
                                />
                            </div>

                            <div className="form-grid">
                                <input 
                                    value={details.returnCity}
                                    onChange={(e) => setDetails({...details, returnCity: e.target.value})}
                                    placeholder="City"
                                />
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem'}}>
                                    <input 
                                        value={details.returnState}
                                        onChange={(e) => setDetails({...details, returnState: e.target.value.toUpperCase()})}
                                        placeholder="ST"
                                        maxLength="2"
                                    />
                                    <input 
                                        value={details.returnZip}
                                        onChange={(e) => setDetails({...details, returnZip: e.target.value})}
                                        placeholder="ZIP"
                                    />
                                </div>
                            </div>

                            <button 
                                className="btn-primary" 
                                style={{width: '100%', marginTop: '1.5rem'}}
                                onClick={() => setStep(3)}
                                disabled={!details.names || !details.returnAddr}
                            >
                                Continue to Add Guests ‚Üí
                            </button>
                        </div>
                    </div>
                );
            }

            // STEP 3: Add Guests
            if (step === 3) {
                return (
                    <div className="container">
                        <div className="back-link" onClick={() => setStep(2)}>
                            ‚Üê Back
                        </div>
                        <h2 className="page-title">Add Your Guests</h2>

                        {guests.length > 0 && (
                            <div style={{
                                background: '#E1E7EF',
                                padding: '0.75rem 1rem',
                                borderRadius: '8px',
                                marginBottom: '1rem',
                                textAlign: 'center',
                                fontSize: '0.9rem',
                                color: '#008182'
                            }}>
                                Your guest list is automatically saved as you add guests ({guests.length} added)
                            </div>
                        )}

                        {inputMethod && (
                            <div style={{textAlign: 'center', marginBottom: '1rem'}}>
                                <button
                                    onClick={() => setInputMethod(null)}
                                    style={{
                                        background: 'transparent',
                                        border: '1px solid #31D7CA',
                                        color: '#31D7CA',
                                        padding: '0.5rem 1rem',
                                        borderRadius: '6px',
                                        cursor: 'pointer',
                                        fontSize: '0.875rem',
                                        fontWeight: '500'
                                    }}
                                >
                                    üîÑ Switch Input Method
                                </button>
                            </div>
                        )}

                        {!inputMethod && (
                            <div className="card">
                                <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem'}}>
                                    <button 
                                        className="btn-secondary" 
                                        style={{height: '120px', fontSize: '1.125rem'}}
                                        onClick={() => setInputMethod('bulk')}
                                    >
                                        üìä Upload CSV
                                    </button>
                                    <button 
                                        className="btn-secondary"
                                        style={{height: '120px', fontSize: '1.125rem'}}
                                        onClick={() => setInputMethod('manual')}
                                    >
                                        ‚úçÔ∏è Enter Manually
                                    </button>
                                </div>
                            </div>
                        )}

                        {inputMethod === 'bulk' && (
                            <div className="card">
                                {guests.length === 0 ? (
                                    <>
                                        <div 
                                            className={`upload-zone ${dragOver ? 'drag-over' : ''}`}
                                            onClick={() => fileInputRef.current?.click()}
                                            onDragOver={handleDragOver}
                                            onDragLeave={handleDragLeave}
                                            onDrop={handleDrop}
                                        >
                                            <div className="upload-icon">üìÑ</div>
                                            <div className="upload-text">Click to Upload CSV</div>
                                            <div className="upload-hint">or drag and drop</div>
                                        </div>
                                        <div style={{marginTop: '1rem', padding: '1rem', background: '#F4F7FC', borderRadius: '8px', fontSize: '0.875rem', color: '#666', textAlign: 'left'}}>
                                            <strong style={{color: '#008182'}}>Required CSV Columns:</strong> Guest1FirstName, Guest1LastName, Address, City, State, Zip<br/>
                                            <strong style={{color: '#008182', marginTop: '0.5rem', display: 'block'}}>Optional Columns:</strong> Guest2FirstName, Guest2LastName, Gift, Special Moment, Relationship<br/>
                                            <em style={{fontSize: '0.8rem', color: '#999'}}>For couples, include Guest2FirstName and Guest2LastName. Old format (single "Name" column) still supported.</em>
                                            <br/><br/>
                                            <button
                                                onClick={() => {
                                                    const csv = `Guest1FirstName,Guest1LastName,Guest2FirstName,Guest2LastName,Gift,Special Moment,Relationship,Address,City,State,Zip
"Sarah","Johnson","","","wine glasses","heartfelt toast","friend","123 Main St","Boston","MA","02101"
"Jessica","Smith","Mike","Smith","picture frame","traveling so far","cousins","456 Oak Ave","Portland","OR","97201"
"Emily","Davis","","","kitchen mixer","","coworker","789 Pine Rd","Austin","TX","78701"`;
                                                    const blob = new Blob([csv], { type: 'text/csv' });
                                                    const url = URL.createObjectURL(blob);
                                                    const a = document.createElement('a');
                                                    a.href = url;
                                                    a.download = 'guest-list-example.csv';
                                                    a.click();
                                                    URL.revokeObjectURL(url);
                                                }}
                                                style={{
                                                    background: '#008182',
                                                    color: 'white',
                                                    border: 'none',
                                                    padding: '0.5rem 1rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.875rem',
                                                    fontWeight: '600'
                                                }}
                                            >
                                                üì• Download Example CSV
                                            </button>
                                        </div>
                                        <input
                                            ref={fileInputRef}
                                            type="file"
                                            accept=".csv"
                                            onChange={handleFileUpload}
                                        />
                                        <button className="btn-secondary" style={{marginTop: '1rem'}} onClick={() => setInputMethod(null)}>
                                            ‚Üê Choose Different Method
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <div style={{marginBottom: '1.5rem', padding: '1rem', background: '#E1E7EF', borderRadius: '8px'}}>
                                            <strong style={{color: '#008182', fontSize: '1.125rem'}}>
                                                ‚úì {guests.length} guests uploaded successfully
                                            </strong>
                                        </div>
                                        <div className="guest-list" style={{maxHeight: '300px', marginBottom: '1.5rem'}}>
                                            {guests.slice(0, 10).map(g => (
                                                <div key={g.id} className="guest-item">
                                                    <div className="guest-item-info">
                                                        <strong>{formatGuestName(g)}</strong>
                                                        {g.gift && <span>Gift: {g.gift}</span>}
                                                        {g.city && <span> ‚Ä¢ {g.city}, {g.state}</span>}
                                                    </div>
                                                </div>
                                            ))}
                                            {guests.length > 10 && (
                                                <div style={{textAlign: 'center', padding: '1rem', color: '#666'}}>
                                                    + {guests.length - 10} more guests
                                                </div>
                                            )}
                                        </div>
                                        <div style={{display: 'grid', gridTemplateColumns: '1fr 2fr', gap: '1rem'}}>
                                            <button 
                                                className="btn-secondary" 
                                                onClick={() => {
                                                    setGuests([]);
                                                    setInputMethod(null);
                                                }}
                                            >
                                                ‚Üê Start Over
                                            </button>
                                            <button 
                                                className="btn-primary"
                                                onClick={() => setStep(4)}
                                            >
                                                Continue to Design ‚Üí
                                            </button>
                                        </div>
                                    </>
                                )}
                            </div>
                        )}

                        {inputMethod === 'manual' && (
                            <>
                                <div className="card">
                                    <div style={{marginBottom: '1.5rem', padding: '1rem', background: '#F4F7FC', borderRadius: '8px'}}>
                                        <strong style={{color: '#008182', display: 'block', marginBottom: '0.5rem'}}>Guest 1</strong>
                                        <div className="form-grid">
                                            <div>
                                                <label>First Name *</label>
                                                <input
                                                    value={currentGuest.firstName}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, firstName: e.target.value})}
                                                    placeholder="Jessica"
                                                />
                                            </div>
                                            <div>
                                                <label>Last Name *</label>
                                                <input
                                                    value={currentGuest.lastName}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, lastName: e.target.value})}
                                                    placeholder="Smith"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div style={{marginBottom: '1.5rem', padding: '1rem', background: '#F4F7FC', borderRadius: '8px'}}>
                                        <strong style={{color: '#008182', display: 'block', marginBottom: '0.5rem'}}>Guest 2 (Optional - for couples)</strong>
                                        <div className="form-grid">
                                            <div>
                                                <label>First Name</label>
                                                <input
                                                    value={currentGuest.firstName2}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, firstName2: e.target.value})}
                                                    placeholder="Mike"
                                                />
                                            </div>
                                            <div>
                                                <label>Last Name</label>
                                                <input
                                                    value={currentGuest.lastName2}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, lastName2: e.target.value})}
                                                    placeholder="Smith"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="form-grid">
                                        <div>
                                            <label>Gift</label>
                                            <input
                                                value={currentGuest.gift}
                                                onChange={(e) => setCurrentGuest({...currentGuest, gift: e.target.value})}
                                                placeholder="picture frame"
                                                spellCheck="true"
                                            />
                                            <p style={{fontSize: '0.75rem', color: '#999', marginTop: '0.25rem'}}>
                                                Check spelling - AI will use exactly what you type
                                            </p>
                                        </div>
                                    </div>
                                    
                                    <div className="form-section">
                                        <label>Special Moment (Optional)</label>
                                        <textarea
                                            value={currentGuest.memo}
                                            onChange={(e) => setCurrentGuest({...currentGuest, memo: e.target.value})}
                                            rows="2"
                                            placeholder="e.g., 'heartfelt toast' or 'traveling so far to be there'"
                                        />
                                        <p style={{fontSize: '0.875rem', color: '#666', marginTop: '0.5rem'}}>
                                            Will appear as "Your [special moment] was such a special moment."
                                        </p>
                                    </div>

                                    <div className="form-section">
                                        <label>Relationship (Optional)</label>
                                        <input
                                            value={currentGuest.relationship}
                                            onChange={(e) => setCurrentGuest({...currentGuest, relationship: e.target.value})}
                                            placeholder="e.g., friend, cousin, aunt, colleague"
                                        />
                                        <p style={{fontSize: '0.875rem', color: '#666', marginTop: '0.5rem'}}>
                                            Will add "You're such a wonderful [relationship]."
                                        </p>
                                    </div>

                                    <div className="form-section" style={{position: 'relative'}}>
                                        <label>Mailing Address</label>
                                        <input
                                            value={currentGuest.addr}
                                            onChange={(e) => handleGuestAddressInput(e.target.value)}
                                            onBlur={() => setTimeout(() => setShowGuestSuggestions(false), 200)}
                                            placeholder="123 Main Street"
                                            style={{marginBottom: '0.75rem'}}
                                        />
                                        {showGuestSuggestions && guestAddressSuggestions.length > 0 && (
                                            <div className="address-suggestions">
                                                {guestAddressSuggestions.map((addr, i) => (
                                                    <div
                                                        key={i}
                                                        className="address-suggestion"
                                                        onClick={() => handleGuestAddressSelect(addr)}
                                                    >
                                                        {addr.description}
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                        <input
                                            value={currentGuest.addr2}
                                            onChange={(e) => setCurrentGuest({...currentGuest, addr2: e.target.value})}
                                            placeholder="Apartment, Suite, Unit (Optional)"
                                            style={{marginBottom: '0.75rem'}}
                                        />
                                        <div className="form-grid">
                                            <input 
                                                value={currentGuest.city}
                                                onChange={(e) => setCurrentGuest({...currentGuest, city: e.target.value})}
                                                placeholder="City"
                                            />
                                            <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem'}}>
                                                <input 
                                                    value={currentGuest.state}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, state: e.target.value.toUpperCase()})}
                                                    placeholder="ST"
                                                    maxLength="2"
                                                />
                                                <input 
                                                    value={currentGuest.zip}
                                                    onChange={(e) => setCurrentGuest({...currentGuest, zip: e.target.value})}
                                                    placeholder="ZIP"
                                                />
                                            </div>
                                        </div>
                                    </div>

                                    <button className="btn-secondary" onClick={addGuest}>
                                        + Add Guest
                                    </button>
                                </div>

                                {guests.length > 0 && (
                                    <div className="card">
                                        <h3>Guests ({guests.length})</h3>
                                        <div className="guest-list">
                                            {guests.map(g => (
                                                <div key={g.id} className="guest-item">
                                                    <div className="guest-item-info">
                                                        <strong>{formatGuestName(g)}</strong>
                                                        {g.gift && <span>Gift: {g.gift}</span>}
                                                        {g.city && <span> ‚Ä¢ {g.city}, {g.state}</span>}
                                                    </div>
                                                    <button className="delete-btn" onClick={() => deleteGuest(g.id)}>√ó</button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                <button 
                                    className="btn-primary"
                                    style={{width: '100%'}}
                                    onClick={() => setStep(4)}
                                    disabled={guests.length === 0}
                                >
                                    Continue to Design ‚Üí
                                </button>
                            </>
                        )}
                    </div>
                );
            }

            // STEP 4: Design
            if (step === 4) {
                return (
                    <div className="container">
                        <div className="back-link" onClick={() => setStep(3)}>
                            ‚Üê Back
                        </div>
                        <h2 className="page-title">Customize Design</h2>
                        <p className="page-subtitle">{guests.length} guests</p>

                        <div className="card">
                            <div className="form-grid">
                                <div>
                                    <label>Occasion</label>
                                    <select value={details.occasion} onChange={(e) => setDetails({...details, occasion: e.target.value})}>
                                        {Object.entries(occasions).map(([k, v]) => (
                                            <option key={k} value={k}>{v}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label>Message Tone</label>
                                    <select value={details.tone} onChange={(e) => setDetails({...details, tone: e.target.value})}>
                                        {tones.map(t => (
                                            <option key={t.id} value={t.id}>{t.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>

                        </div>

                        <div className="card">
                            <label>Background Color</label>
                            <div className="option-grid-4">
                                {colorPresets.map(c => (
                                    <div
                                        key={c.value}
                                        className={`option-box ${details.color === c.value ? 'selected' : ''}`}
                                        onClick={() => setDetails({...details, color: c.value})}
                                    >
                                        <div className="color-swatch" style={{backgroundColor: c.value}}></div>
                                        <h4>{c.name}</h4>
                                    </div>
                                ))}
                            </div>
                            <div style={{marginTop: '1rem', display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                <label style={{marginBottom: 0}}>Or choose custom color:</label>
                                <input
                                    type="color"
                                    value={details.color}
                                    onChange={(e) => setDetails({...details, color: e.target.value})}
                                    style={{width: '60px', height: '40px', cursor: 'pointer', border: '2px solid #31D7CA', borderRadius: '8px'}}
                                />
                            </div>
                        </div>

                        <div className="card">
                            <label>Font</label>
                            <div className="option-grid-4">
                                {fonts.map(f => (
                                    <div
                                        key={f.id}
                                        className={`option-box ${details.font === f.id ? 'selected' : ''}`}
                                        onClick={() => setDetails({...details, font: f.id})}
                                    >
                                        <div className={`font-preview font-${f.id}`}>Aa</div>
                                        <h4>{f.name}</h4>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="card">
                            <label>Pattern</label>
                            <div className="option-grid-4">
                                {patterns.map(p => (
                                    <div
                                        key={p.id}
                                        className={`option-box ${details.design === p.id ? 'selected' : ''}`}
                                        onClick={() => setDetails({...details, design: p.id})}
                                    >
                                        <div className={`pattern-preview pattern-${p.id}`}></div>
                                        <h4>{p.name}</h4>
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="card">
                            <label>Seal Design</label>
                            <div className="option-grid-4">
                                {sealDesigns.map(s => (
                                    <div
                                        key={s.id}
                                        className={`option-box ${details.sealDesign === s.id ? 'selected' : ''}`}
                                        onClick={() => setDetails({...details, sealDesign: s.id})}
                                    >
                                        <div
                                            className={`seal-preview-box seal-${s.id}`}
                                            style={{
                                                backgroundColor: details.color,
                                                color: details.color === '#FFFFFF' ? '#999' : '#666'
                                            }}
                                        >
                                            {details.initials || (details.names ? details.names.substring(0,2).toUpperCase() : 'AB')}
                                        </div>
                                        <h4>{s.name}</h4>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {isGenerating ? (
                            <div style={{marginTop: '1.5rem', textAlign: 'center'}}>
                                <div style={{
                                    background: '#E1E7EF',
                                    padding: '1.5rem',
                                    borderRadius: '12px',
                                    marginBottom: '1rem'
                                }}>
                                    <div style={{fontSize: '1.5rem', marginBottom: '0.5rem'}}>‚ú®</div>
                                    <div style={{fontSize: '1.1rem', fontWeight: '600', color: '#008182', marginBottom: '0.5rem'}}>
                                        Generating Personalized Messages...
                                    </div>
                                    <div style={{fontSize: '0.9rem', color: '#666', marginBottom: '1rem'}}>
                                        {generationProgress.current} of {generationProgress.total} cards
                                    </div>
                                    <div style={{
                                        width: '100%',
                                        height: '8px',
                                        background: '#E0E0E0',
                                        borderRadius: '4px',
                                        overflow: 'hidden'
                                    }}>
                                        <div style={{
                                            width: `${(generationProgress.current / generationProgress.total) * 100}%`,
                                            height: '100%',
                                            background: 'linear-gradient(90deg, #008182, #31D7CA)',
                                            transition: 'width 0.3s ease'
                                        }}></div>
                                    </div>
                                    <div style={{fontSize: '0.85rem', color: '#999', marginTop: '1rem'}}>
                                        This will take about {Math.ceil(generationProgress.total * 3 / 60)} minute{Math.ceil(generationProgress.total * 3 / 60) !== 1 ? 's' : ''}. Please be patient!
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <button
                                className="btn-primary"
                                style={{width: '100%'}}
                                onClick={handleGenerate}
                            >
                                Generate Cards ‚Üí
                            </button>
                        )}
                    </div>
                );
            }

            // STEP 5: Review and Edit Messages
            if (step === 5) {
                const handleEditMessage = (index) => {
                    setEditingNoteIndex(index);
                };

                const handleSaveMessage = (index, newContent) => {
                    const updatedNotes = [...notes];
                    updatedNotes[index].content = newContent;
                    setNotes(updatedNotes);
                    setEditingNoteIndex(null);
                };

                return (
                    <div className="container">
                        <h2 className="page-title">Review Your Messages ‚úèÔ∏è</h2>
                        <p className="page-subtitle">Review and edit your {notes.length} personalized cards</p>

                        <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                            {notes.map((note, index) => (
                                <div key={index} className="card">
                                    <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '0.75rem'}}>
                                        <div>
                                            <h4 style={{color: '#008182', marginBottom: '0.25rem'}}>{note.guestName}</h4>
                                            <p style={{color: '#999', fontSize: '0.875rem', margin: 0}}>Gift: {note.gift}</p>
                                        </div>
                                        {editingNoteIndex !== index && (
                                            <button
                                                onClick={() => handleEditMessage(index)}
                                                style={{
                                                    background: 'transparent',
                                                    border: '1px solid #31D7CA',
                                                    color: '#31D7CA',
                                                    padding: '0.4rem 0.9rem',
                                                    borderRadius: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '0.875rem',
                                                    fontWeight: '500'
                                                }}
                                            >
                                                ‚úèÔ∏è Edit
                                            </button>
                                        )}
                                    </div>
                                    {editingNoteIndex === index ? (
                                        <div>
                                            <textarea
                                                value={note.content}
                                                onChange={(e) => {
                                                    const updatedNotes = [...notes];
                                                    updatedNotes[index].content = e.target.value;
                                                    setNotes(updatedNotes);
                                                }}
                                                style={{
                                                    width: '100%',
                                                    minHeight: '120px',
                                                    padding: '0.75rem',
                                                    border: '2px solid #31D7CA',
                                                    borderRadius: '8px',
                                                    fontSize: '0.95rem',
                                                    fontFamily: 'inherit',
                                                    resize: 'vertical'
                                                }}
                                            />
                                            <div style={{display: 'flex', gap: '0.5rem', marginTop: '0.5rem'}}>
                                                <button
                                                    onClick={() => handleSaveMessage(index, note.content)}
                                                    style={{
                                                        background: '#008182',
                                                        color: 'white',
                                                        border: 'none',
                                                        padding: '0.5rem 1rem',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        fontSize: '0.875rem',
                                                        fontWeight: '500'
                                                    }}
                                                >
                                                    ‚úì Save
                                                </button>
                                                <button
                                                    onClick={() => setEditingNoteIndex(null)}
                                                    style={{
                                                        background: 'transparent',
                                                        border: '1px solid #999',
                                                        color: '#666',
                                                        padding: '0.5rem 1rem',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        fontSize: '0.875rem'
                                                    }}
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <p style={{color: '#666', lineHeight: '1.6', margin: 0}}>{note.content}</p>
                                    )}
                                </div>
                            ))}
                        </div>

                        <button
                            className="btn-primary"
                            style={{width: '100%', marginTop: '1.5rem'}}
                            onClick={() => setStep(6)}
                        >
                            Continue to Download ‚Üí
                        </button>
                    </div>
                );
            }

            // STEP 6: Download
            if (step === 6) {
                return (
                    <div className="container">
                        <h2 className="page-title">Ready! üéâ</h2>
                        <p className="page-subtitle">{notes.length} personalized cards</p>

                        <div className="download-grid">
                            <div className="download-card">
                                <div className="download-icon">üíå</div>
                                <h4>Cards</h4>
                                <button className="btn-primary" style={{width: '100%'}} onClick={generateCardsPDF}>üì• Download</button>
                            </div>
                            <div className="download-card">
                                <div className="download-icon">üè∑Ô∏è</div>
                                <h4>Recipient Labels</h4>
                                <button className="btn-primary" style={{width: '100%'}} onClick={generateRecipientLabelsPDF}>üì• Download</button>
                            </div>
                            <div className="download-card">
                                <div className="download-icon">üìÆ</div>
                                <h4>Return Labels</h4>
                                <button className="btn-primary" style={{width: '100%'}} onClick={generateReturnLabelsPDF}>üì• Download</button>
                            </div>
                            <div className="download-card">
                                <div className="download-icon">üí´</div>
                                <h4>Seals</h4>
                                <button className="btn-primary" style={{width: '100%'}} onClick={generateSealsPDF}>üì• Download</button>
                            </div>
                        </div>

                        <div className="card" style={{marginTop: '2rem', background: 'linear-gradient(135deg, #E1E7EF 0%, #F4F7FC 100%)'}}>
                            <h3 style={{color: '#008182', marginBottom: '1rem', textAlign: 'center'}}>üìã How to Use Your Downloads</h3>
                            <div style={{display: 'grid', gap: '1rem'}}>
                                <div style={{padding: '1rem', background: 'white', borderRadius: '8px', border: '1px solid #E0E0E0'}}>
                                    <div style={{display: 'flex', alignItems: 'flex-start', gap: '0.75rem'}}>
                                        <div style={{fontSize: '1.5rem', flexShrink: 0}}>üíå</div>
                                        <div>
                                            <strong style={{color: '#008182', display: 'block', marginBottom: '0.25rem'}}>Cards</strong>
                                            <p style={{margin: 0, color: '#666', fontSize: '0.9rem', lineHeight: '1.5'}}>
                                                Print on Avery 5389 postcard stock (4 postcards per 8.5" x 11" sheet). Each postcard is 5.5" x 4.25" - no folding required! The design and message are already formatted and ready to print.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div style={{padding: '1rem', background: 'white', borderRadius: '8px', border: '1px solid #E0E0E0'}}>
                                    <div style={{display: 'flex', alignItems: 'flex-start', gap: '0.75rem'}}>
                                        <div style={{fontSize: '1.5rem', flexShrink: 0}}>üè∑Ô∏è</div>
                                        <div>
                                            <strong style={{color: '#008182', display: 'block', marginBottom: '0.25rem'}}>Recipient Labels</strong>
                                            <p style={{margin: 0, color: '#666', fontSize: '0.9rem', lineHeight: '1.5'}}>
                                                Print on Avery 5160 label sheets (or compatible). Peel and stick each label to the front of your envelopes. Labels are pre-formatted to fit perfectly!
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div style={{padding: '1rem', background: 'white', borderRadius: '8px', border: '1px solid #E0E0E0'}}>
                                    <div style={{display: 'flex', alignItems: 'flex-start', gap: '0.75rem'}}>
                                        <div style={{fontSize: '1.5rem', flexShrink: 0}}>üìÆ</div>
                                        <div>
                                            <strong style={{color: '#008182', display: 'block', marginBottom: '0.25rem'}}>Return Labels</strong>
                                            <p style={{margin: 0, color: '#666', fontSize: '0.9rem', lineHeight: '1.5'}}>
                                                Print on Avery 5160 label sheets. These go on the back flap of your envelopes (top left corner). They show your return address so cards can come back if undeliverable.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                <div style={{padding: '1rem', background: 'white', borderRadius: '8px', border: '1px solid #E0E0E0'}}>
                                    <div style={{display: 'flex', alignItems: 'flex-start', gap: '0.75rem'}}>
                                        <div style={{fontSize: '1.5rem', flexShrink: 0}}>üí´</div>
                                        <div>
                                            <strong style={{color: '#008182', display: 'block', marginBottom: '0.25rem'}}>Seals</strong>
                                            <p style={{margin: 0, color: '#666', fontSize: '0.9rem', lineHeight: '1.5'}}>
                                                Print on 1.5" round sticker label sheets. Peel and stick to the back flap of your envelopes after sealing them. This adds a beautiful finishing touch!
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style={{marginTop: '1.5rem', padding: '1rem', background: 'rgba(45, 88, 83, 0.05)', borderRadius: '8px', borderLeft: '3px solid #008182'}}>
                                <strong style={{color: '#008182', display: 'block', marginBottom: '0.5rem'}}>üí° Pro Tip</strong>
                                <p style={{margin: 0, color: '#666', fontSize: '0.9rem', lineHeight: '1.5'}}>
                                    If you don't have a printer at home, save the PDFs to a USB drive and take them to your local print shop (Staples, FedEx Office, or UPS Store). They can print everything for you!
                                </p>
                            </div>
                        </div>

                        <div className="card" style={{marginTop: '2rem', background: 'linear-gradient(135deg, #008182 0%, #31D7CA 100%)', border: 'none', boxShadow: '0 4px 16px rgba(0,129,130,0.2)'}}>
                            <h3 style={{color: 'white', marginBottom: '1rem'}}>üì¶ Required Supplies</h3>
                            <p style={{color: 'rgba(255, 255, 255, 0.95)', marginBottom: '1.5rem', fontSize: '0.9rem'}}>Shop on Amazon:</p>

                            <div style={{display: 'grid', gap: '0.75rem'}}>
                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem 0'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <span style={{fontSize: '1.25rem'}}>üíå</span>
                                        <div>
                                            <strong style={{color: 'white'}}>Avery 5389 Postcards</strong>
                                            <span style={{color: 'rgba(255, 255, 255, 0.8)', marginLeft: '0.5rem', fontSize: '0.875rem'}}>‚Äî 4 per sheet, 5.5" x 4.25"</span>
                                        </div>
                                    </div>
                                    <a
                                        href="https://www.amazon.com/Avery-Printable-Invitation-Printers-Postcards/dp/B001PMC4TW"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        style={{
                                            background: 'white',
                                            color: '#008182',
                                            padding: '0.4rem 0.9rem',
                                            borderRadius: '6px',
                                            textDecoration: 'none',
                                            fontWeight: '600',
                                            fontSize: '0.875rem'
                                        }}
                                    >
                                        Shop ‚Üí
                                    </a>
                                </div>

                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem 0'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <span style={{fontSize: '1.25rem'}}>üè∑Ô∏è</span>
                                        <div>
                                            <strong style={{color: 'white'}}>Address Labels (Avery 5160)</strong>
                                            <span style={{color: 'rgba(255, 255, 255, 0.8)', marginLeft: '0.5rem', fontSize: '0.875rem'}}>‚Äî 1" x 2‚Öù" labels</span>
                                        </div>
                                    </div>
                                    <a
                                        href="https://www.amazon.com/Avery-Address-Inkjet-Printers-Sheets/dp/B00004Z5SM"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        style={{
                                            background: 'white',
                                            color: '#008182',
                                            padding: '0.4rem 0.9rem',
                                            borderRadius: '6px',
                                            textDecoration: 'none',
                                            fontWeight: '600',
                                            fontSize: '0.875rem'
                                        }}
                                    >
                                        Shop ‚Üí
                                    </a>
                                </div>

                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem 0'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <span style={{fontSize: '1.25rem'}}>üí´</span>
                                        <div>
                                            <strong style={{color: 'white'}}>Round Sticker Labels (1.5")</strong>
                                            <span style={{color: 'rgba(255, 255, 255, 0.8)', marginLeft: '0.5rem', fontSize: '0.875rem'}}>‚Äî for envelope seals</span>
                                        </div>
                                    </div>
                                    <a
                                        href="https://www.amazon.com/s?k=1.5+inch+round+sticker+labels+printable+white"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        style={{
                                            background: 'white',
                                            color: '#008182',
                                            padding: '0.4rem 0.9rem',
                                            borderRadius: '6px',
                                            textDecoration: 'none',
                                            fontWeight: '600',
                                            fontSize: '0.875rem'
                                        }}
                                    >
                                        Shop ‚Üí
                                    </a>
                                </div>

                                <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0.75rem 0'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <span style={{fontSize: '1.25rem'}}>‚úâÔ∏è</span>
                                        <div>
                                            <strong style={{color: 'white'}}>A2 Envelopes (4‚Öú" x 5¬æ")</strong>
                                            <span style={{color: 'rgba(255, 255, 255, 0.8)', marginLeft: '0.5rem', fontSize: '0.875rem'}}>‚Äî fits postcards</span>
                                        </div>
                                    </div>
                                    <a
                                        href="https://www.amazon.com/s?k=a2+envelopes+4.375+x+5.75+white"
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        style={{
                                            background: 'white',
                                            color: '#008182',
                                            padding: '0.4rem 0.9rem',
                                            borderRadius: '6px',
                                            textDecoration: 'none',
                                            fontWeight: '600',
                                            fontSize: '0.875rem'
                                        }}
                                    >
                                        Shop ‚Üí
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div className="card" style={{marginTop: '2rem', textAlign: 'center'}}>
                            <h4 style={{color: '#008182', marginBottom: '1rem'}}>üñ®Ô∏è Find Nearby Print Shops</h4>
                            <p style={{color: '#666', marginBottom: '1rem', fontSize: '0.9rem'}}>
                                Search for print shops near your location
                            </p>
                            <a
                                href={(() => {
                                    const address = [details.returnAddr, details.returnAddr2, details.returnCity, details.returnState, details.returnZip]
                                        .filter(Boolean)
                                        .join(', ');
                                    return `https://www.google.com/maps/search/print+shop/@?api=1&query=print+shop+near+${encodeURIComponent(address)}`;
                                })()}
                                target="_blank"
                                rel="noopener noreferrer"
                                className="btn-secondary"
                                style={{display: 'inline-block', textDecoration: 'none'}}
                            >
                                Search on Google Maps ‚Üí
                            </a>
                        </div>

                        <div style={{textAlign: 'center', marginTop: '2rem'}}>
                            <button
                                onClick={() => {
                                    if (confirm('Start over with a new event? Your current progress will be cleared.')) {
                                        setStep(1);
                                        setGuests([]);
                                        setNotes([]);
                                        setInputMethod(null);
                                    }
                                }}
                                style={{
                                    background: '#FF6B35',
                                    color: 'white',
                                    border: 'none',
                                    padding: '0.75rem 1.5rem',
                                    fontSize: '1rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontWeight: '600',
                                    transition: 'all 0.3s'
                                }}
                                onMouseOver={(e) => e.target.style.background = '#E85A2A'}
                                onMouseOut={(e) => e.target.style.background = '#FF6B35'}
                            >
                                üîÑ Start Over with New Event
                            </button>
                        </div>
                    </div>
                );
            }

            return null;
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>